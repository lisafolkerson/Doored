<?php // Before trying to crack the plugin, please consider buying a pro license at https://www.mapsmarker.com. I have put hundreds of hours into the development of the plugin and without honest customers I will not be able to continue the development and support. Thanks for your understanding and your honesty! Robert
if (basename($_SERVER["\123\103\122IPT_FILENAM\105"]) == "\154eaflet-core.php") { exit ("\120lease do not acce\163\163\040this file\040\144\151rectly. \124\150anks!<br/><\141\040\150ref='ht\164\160\163://www.m\141\160\163marker\056\143\157m/go'>\167\167\167.mapsma\162\153\145r.com</a\076"); } if (is_admin()) { include_once (ABSPATH."wp-\141\144\155in".DIRECTORY_SEPARATOR."\151ncludes".DIRECTORY_SEPARATOR."plugin.p\150\160"); if (is_plugin_active("\154eaflet-maps-mark\145\162\057leaflet-ma\160\163\055marker.ph\160")) { if (!is_multisite()) { deactivate_plugins("\154\145\141flet-maps-mar\153\145\162/leaflet-ma\160\163\055marker.php",$silent=FALSE,$network_wide=NULL); activate_plugin("\154\145aflet-maps-marke\162\055pro/leaflet-map\163\055marker.php",$redirect="\160\154ugins.php?act\151\166\141te=true",$network_wide=FALSE,$silent=FALSE); } else { include_once (ABSPATH."wp-inc\154\165\144es".DIRECTORY_SEPARATOR."plugga\142\154\145.php"); if (is_network_admin()) { deactivate_plugins("\154eaflet-maps-mar\153\145\162/leaflet-map\163\055\155arker.php",$silent=FALSE,$network_wide=TRUE); activate_plugin("\154\145aflet-maps-marke\162\055\160ro/leaflet-\155\141\160s-marker.p\150\160",$redirect=FALSE,$network_wide=TRUE,$silent=FALSE); } else { deactivate_plugins("l\145\141\146let-maps-mark\145\162\057leaflet-ma\160\163\055marker.ph\160",$silent=FALSE,$network_wide=NULL); activate_plugin("\154eaflet-maps-mar\153\145\162-pro/leaflet\055\155\141ps-marker.p\150\160",$redirect="\160lugins.php?activ\141\164\145=true",$network_wide=FALSE,$silent=FALSE); } } } } define( "l0" ,"\164\060006382341k"); define( "LEAFLET_WP_ADMIN_URL" ,get_admin_url()); define( "LEAFLET_PLUGIN_URL" ,plugin_dir_url( __FILE__)); define( "LEAFLET_PLUGIN_DIR" ,plugin_dir_path( __FILE__)); $O0=wp_upload_dir(); define( "LEAFLET_PLUGIN_ICONS_URL" ,$O0["\142aseurl"]."/leaflet-m\141\160\163-marker-icon\163"); define( "LEAFLET_PLUGIN_ICONS_DIR" ,$O0["\142asedir"].DIRECTORY_SEPARATOR."\154\145\141flet-maps-mark\145\162\055icons"); define( "LEAFLET_PLUGIN_QR_URL" ,$O0["baseurl"]."/leaflet-maps-\155\141\162ker-qr-cod\145\163"); define( "LEAFLET_PLUGIN_QR_DIR" ,$O0["basedir"].DIRECTORY_SEPARATOR."leaflet-m\141\160\163-marker-qr-c\157\144\145s"); define( "l1" ,get_admin_url()); define( "O1" ,plugin_dir_url( __FILE__)); define( "l2" ,plugin_dir_path( __FILE__)); define( "O2" ,$O0["baseurl"]."/leaflet-\155\141\160s-marker-ic\157\156\163"); define( "l3" ,$O0["\142asedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-marke\162\055icons"); if (is_admin()) { require_once (plugin_dir_path( __FILE__)."\151\156\143".DIRECTORY_SEPARATOR."cla\163\163\055plugin-update-\143\150\145cker.php"); } function O3() { if ((substr($_SERVER["REMOTE_ADD\122"],0,4) == "127.") || ($_SERVER["REMOTE_ADDR"] == "\072:1")) { return TRUE; } else { return FALSE; } } class l4 { function __construct() { $O4=get_option("lea\146\154etmapsmarker_o\160\164\151ons"); add_action("\151nit",array( &$this,"lmm_load_translat\151\157n_files"),1); add_action("\141\144min_init",array( &$this,"l\155\155\137load_settings_cl\141\163\163"),2); add_action("\141\144\155in_init",array( &$this,"lmm_install_\141\156\144_updates"),3); add_action("\167p_enqueue_s\143\162\151pts",array( &$this,"\154mm_frontend_enq\165\145\165e_scripts")); add_action("wp_print_styles",array( &$this,"lmm_fro\156\164\145nd_enqueue_st\171\154\145sheets"),4); add_action("\141dmin_menu",array( &$this,"\154mm_admin_menu"),5); add_action("\141\144min_init",array( &$this,"\154mm_plugin_meta\137\154\151nks"),6); add_action("\167p_ajax_mapsmark\145\162\137ajax_actions",array( &$this,"lmm_ajax_actions"),7); add_action("\141\144min_bar_menu",array( &$this,"\154\155m_add_admin_bar\137\155\145nu"),0225); if (!empty($O4)) { add_shortcode($O4["\163hortcode"],array( &$this,"\154\155m_showmap")); } add_filter("wi\144\147\145t_text","d\157\137\163hortcode"); if ( isset ($O4["\155isc_global_adm\151\156\137notices"]) && ($O4["\155isc_global_\141\144\155in_notices"] == "\163\150ow")) { add_action("ad\155\151\156_notices",array( &$this,"lmm_compatibility_\143\150\145cks")); } if (!empty($O4)) { if ($O4["\155isc_add_georss\137\164\157_head"] == "enabled") { add_action("wp_head",array( &$this,"lmm_ad\144\137\147eorss_to_head")); } } if ( isset ($O4["misc_tinymce_\142\165\164ton"]) && ($O4["misc_\164\151\156ymce_button"] == "enabled")) { require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\164inymce-plugin\056\160\150p"); } if ( isset ($O4["misc_plugin_\154\141\156guage"]) && ($O4["\155\151sc_plugin_langua\147\145"] != "\141utomatic")) { add_filter("plugin_locale",array( &$this,"lmm_set_plugin_lo\143\141\154e"),"lmm"); } add_action("widgets_init",create_function("","\162eturn register\137\167\151dget(\042\103\154\141ss_leaflet_\162\145\143ent_marke\162\137\167idget\042\051\073")); if ( isset ($O4["misc\137\141\144min_dashboar\144\137\167idget"]) && ($O4["\155\151\163c_admin_dashb\157\141\162d_widget"] == "enabled")) { if (!is_multisite()) { add_action("\167\160\137dashboard_set\165\160",array( &$this,"lmm_register_wid\147\145\164s")); } else { add_action("\167\160\137network_dash\142\157\141rd_setup",array( &$this,"l\155\155\137register_widget\163")); add_action("\167\160_dashboard_setup",array( &$this,"lmm_register_w\151\144\147ets")); } } if (( isset ($O4["\155\151\163c_pointers"])) && ($O4["misc_pointers"] == "enabled")) { $version_before_update=get_option("leafl\145\164\155apsmarker_ve\162\163\151on_pro_befo\162\145\137update"); if ($version_before_update != "\060") { add_action("\141\144\155in_enqueue_\163\143\162ipts",array($this,"lmm_update_po\151\156\164er_admin_scr\151\160\164s"),01751); } } add_action("admin_\145\156\161ueue_scripts",array($this,"\154\155\155_feature_poin\164\145\162_admin_scrip\164\163"),01752); if (is_multisite()) { add_action("\144\145\154ete_blog",array( &$this,"lmm\137\144\145lete_multisite\137\142\154og")); } add_action("\164emplate_incl\165\144\145",array( &$this,"lmm_template_c\150\145\143k_shortcode")); add_action("\160lugin_row_meta",array( &$this,"lmm_plugins_pag\145\137\141dd_links"),012,2); add_filter("u\160\154\157ad_mimes",array( &$this,"lmm_permit_m\151\155\145_types_on_uplo\141\144")); add_filter("p\157\163\164_mime_types",array( &$this,"lmm_modify_post_mi\155\145\137types")); } function lmm_ajax_actions() { include ("\151nc".DIRECTORY_SEPARATOR."\141\152ax-actions.ph\160"); } function lmm_register_activation_hook() { global $wp_version; if (version_compare($wp_version,"\063.3","<")) { exit ("[Maps Marker \120\162\157 - installat\151\157\156 failed!]: \127\157\162dPress Ve\162\163\151on 3.3 or\040\150igher is ne\145\144\145d for th\151\163\040plugin \050\171\157u are u\163\151\156g versio\156\040".$wp_version."\051 - please upgra\144\145\040your WordPres\163\040\151nstallati\157\156\041"); } if (version_compare(phpversion(),"\065\0562","\074")) { exit ("\133\115aps Marker Pro \055\040\151nstallation \146\141\151led]: PHP 5\056\062 is needed fo\162\040\164his plug\151\156\040(you ar\145\040using PHP ".phpversion()."; note\072\040\163upport for P\110\120\0404 has bee\156\040\157fficially \144\151\163continued\040\163\151nce 2007\055\0612-31!) - pl\145\141\163e upgra\144\145\040your PH\120\040\151nstallat\151\157\156!"); } } function lmm_modify_post_mime_types($post_mime_types) { $post_mime_types["\164ext/gpx"]=array(__("GPX \164\162ack","lmm"),__("Manage GPX trac\153\163","lmm"),_n_noop("\107PX track <sp\141\156\040class=\042\143\157unt\042>(%\163\051\074/span>","G\120\130\040tracks <span cl\141\163\163=\042count\042\076\050%s)</span\076","\154\155m")); return $post_mime_types; } function lmm_permit_mime_types_on_upload($existing_mimes=array()) { $existing_mimes["\147px"]="t\145\170\164/gpx"; return $existing_mimes; } function lmm_plugins_page_add_links($links,$file) { $plugin="\154eaflet-maps-\155\141\162ker-pro/leafl\145\164\055maps-mark\145\162\056php"; $l5=get_option("leafletmapsmarke\162\137\166ersion_pro"); if ($file == $plugin) { $O5="<a style=\042\164ext-decoratio\156\072\156one;\042\040\164itle=\042".esc_attr__("MapsMarker aff\151\154\151ate program \055\040\163ign up n\157\167\040and recei\166\145\040commissi\157\156\163 up to 5\060\045!","\154\155m")."\042 h\162\145\146=\042https:\057\057\167ww.mapsmark\145\162\056com/aff\151\154\151ates\042\040\164\141rget=\042\137\142lank\042\076\074img src=\042".O1."\151\156\143/img/icon-a\146\146\151liates.png\042\040\167idth=\042\061\066\042 heigh\164\075\04216\042 \141\154\164=\042".esc_attr__("MapsM\141\162\153er affiliate \160\162\157gram - si\147\156\040up now a\156\144\040receive c\157\155\155issions \165\160\040to 50\045\041","lmm")."\042>\074\057\141>"; $l6="\074a style=\042t\145\170\164-decoration:\156\157\156e;\042 t\151\164\154e=\042".esc_attr__("\115apsMarker resell\145\162\040program - r\145\055\163ell with \141\04020% discount!","lmm")."\042 h\162\145\146=\042https:\057\057\167ww.mapsmark\145\162\056com/rese\154\154\145r\042 ta\162\147\145t=\042_\142\154\141nk\042\076\074\151mg sr\143\075\042".O1."inc/i\155\147\057icon-reseller\163\056png\042 wid\164\150\075\04216\042\040\150eight=\042\061\066\042 alt=\042".esc_attr__("\115apsMarker res\145\154\154er program - \162\145\055sell with \141\04020% discount\041","lmm")."\042></a>"; $O6="\074a style=\042\164\145xt-decoration:\156\157\156e;\042 h\162\145\146=\042http\163\072\057/www.ma\160\163\155arker.co\155\057\162eview\163\042\040target\075\042_blank\042\040\164\151tle=\042".esc_attr__("plea\163\145\040rate this \160\154\165gin on word\160\162\145ss.org","\154\155\155")."\042><im\147\040\163rc=\042".O1."\151\156c/img/icon-st\141\162\056png\042\040\167\151dth=\042\061\066\042 he\151\147\150t=\0421\066\042 alt=\042".esc_attr__("\160lease rate \164\150\151s plugin on w\157\162\144press.org","\154\155\155")."\042\076\074\057a>"; $l7="\074\141 href=\042h\164\164\160s://transla\164\145\056mapsmarker\056\143\157m/projec\164\163\057lmm\042\040\164arget=\042\137\142lank\042 \164\151tle=\042".esc_attr__("transl\141\164\151ons","\154mm")."\042><img src\075\042".O1."inc/img/icon-tr\141\156\163lations.png\042\040\167idth=\042\061\066\042 heigh\164\075\04216\042 \141\154\164=\042".esc_attr__("\164\162anslations","\154mm")."\042></a>"; $O7="\074\141 href=\042\150\164\164ps://face\142\157\157k.com/maps\155\141\162ker\042 \164\141\162get=\042\137\142lank\042\040\164\151tle=\042".esc_attr__("\106ollow MapsMarke\162\040\157n Facebook","lmm")."\042\076\074img src=\042".O1."inc/img/icon-fa\143\145\142ook.png\042\040\167\151dth=\042\061\066\042 height\075\042\0616\042 \141\154\164=\042".esc_attr__("\106\157llow MapsMark\145\162\040on Facebook","lmm")."\042\076</a>"; $l8="\074a href=\042h\164\164\160s://twitter.c\157\155\057mapsmarke\162\042\040target=\042\137\142lank\042 \164\151\164le=\042".esc_attr__("\106\157\154low @MapsMark\145\162\040on Twitter","\154mm")."\042\076<img src=\042".O1."\151nc/img/icon-twi\164\164\145r.png\042 w\151\144\164h=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042".esc_attr__("\106\157\154low @MapsMar\153\145\162 on Twitter","lmm")."\042></\141\076"; $O8="<a href=\042h\164\164\160s://www.maps\155\141\162ker.com/+\042\040target=\042\137\142\154ank\042 t\151\164\154e=\042".esc_attr__("Follow Maps\115\141\162ker on Goog\154\145\053","lmm")."\042><img src\075\042".O1."\151\156\143/img/icon-\147\157\157gle-plus.png\042\040\167idth=\042\061\066\042 height\075\042\0616\042\040\141\154t=\042".esc_attr__("Follow MapsMarker\040\157\156 Google+","\154\155m")."\042></a>"; $l9="\074a href=\042\150\164\164p://feeds.fe\145\144\142urner.com/M\141\160\163Marker\042\040\164arget=\042\137\142\154ank\042\040\164itle=\042\122\123\123\042>\074\151\155g src=\042".O1."inc/img/icon-rss.p\156\147\042 width=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042\162\163\163\042></a\076"; $O9="<a href=\042\150\164tp://feedbur\156\145\162.google.com\057\146\142/a/mailver\151\146\171?uri=MapsM\141\162\153er\042 \164\141\162get=\042\137\142lank\042\040\164\151tle=\042\122\123S (via Ema\151\154\051\042>\074\151\155g src=\042".O1."inc/img\057\151\143on-rss-email.\160\156\147\042 width\075\04216\042 heig\150\164\075\04216\042\040\141lt=\042r\163\163\055email\042\076\074/a>"; if ((la($Oa=FALSE,$lb=TRUE) === TRUE) && (la() === FALSE)) { $Ob="\074br/></td></tr><t\162\076\074td colspan\075\042\063\042 st\171\154\145=\042bord\145\162\055bottom:1\160\170\040solid #\143\143\143;paddin\147\072\060;\042\076\074\144iv styl\145\075\042paddin\147\072\0403px 5p\170\073\142ackgrou\156\144\055color:\040\043FFEBE8;bor\144\145\162: 1px \163\157\154id #CC\060\06000;color: \043\06333;\042>\074\163trong>".__("Warni\156\147\072 your access t\157\040\165pdates and\040\163\165pport for \114\145\141flet Maps\040\115\141rker Pr\157\040\150as exp\151\162\145d!","lmm")."</strong><br/>"; $lc=get_option("l\145\141\146letmapsmarker_\166\145\162sion_pro_late\163\164"); if (($lc != NULL) && ($lc>$l5)) { $Ob.=__("\114atest available \166\145\162sion:","\154mm")."\040<a href='http\163\072\057/www.mapsmar\153\145\162.com/v".$lc."p' target='_bl\141\156\153' title='".esc_attr__("click to sh\157\167\040release notes","lmm")."\047>".$lc."\074/a> "."(<a href=\047\167\167w.mapsmarker\056\143\157m/changelog/p\162\157\057' target='_b\154\141\156k'>".__("show\040\141\154l available\040\143\150angelogs","lmm")."\074\057a>)<br/>"; } $Ob.=sprintf(__("\131\157u can continue u\163\151\156g version %s\040\167\151thout any \154\151\155itations. \116\145\166ertheless\040\171\157u will \156\157t be able\040\164o get updat\145\163\040includi\156\147\040bugfixe\163\054 new featu\162\145\163 and op\164\151\155ization\163\040as well as\040\141ccess to o\165\162\040suppo\162\164\040system\056\040","\154\155\155"),$l5)."\074br/>".sprintf(__("\074\141\040href=\042\045\163\042>Please r\145\156\145w your acce\163\163\040to update\163\040\141nd suppo\162\164\040to keep\040\171\157ur plug\151\156\040up-to-d\141\164\145 and sa\146\145\074/a>.","\154\155m"),l1."admin.php?\160\141\147e=leafletma\160\163\155arker_licen\163\145")."\074\057\144iv>"; } else { $Ob=""; } $links[]=$O5."&nbsp;".$l6."&nbsp;".$O6."&nbsp;".$l7."&nbsp;".$O7."\046nbsp;".$l8."&nbsp;".$O8."\046\156bsp;".$l9."\046\156bsp;".$O9.$Ob; } return $links; } function lmm_delete_multisite_blog($blog_id) { switch_to_blog($blog_id); $GLOBALS["\167\160\144b"]->query("DROP TABLE `".$GLOBALS["wpdb"]->prefix."leafletmapsmar\153\145\162_layers`"); $GLOBALS["\167\160\144b"]->query("\104ROP TABLE `".$GLOBALS["wpdb"]->prefix."leafletmapsmarker\137\155\141rkers`"); $O0=wp_upload_dir(); $icons_directory=$O0["\142asedir"].DIRECTORY_SEPARATOR."\154\145\141flet-maps-ma\162\153\145r-icons".DIRECTORY_SEPARATOR; if (is_dir($icons_directory)) { foreach (glob($icons_directory."*.*") as $v) { unlink($v); } rmdir($icons_directory); } } function lmm_update_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"\144\151\163missed_wp_po\151\156\164ers",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Oc=FALSE; $lmm_version_new=get_option("leafletmap\163\155\141rker_version_\160\162\157"); $ld="\154\155mvp".str_replace(".","",$lmm_version_new); if (! isset ($dismissed_pointers[$ld])) { $current_dismissed_wp_pointers=get_user_meta(get_current_user_id(),"\144\151smissed_wp_poin\164\145\162s"); $replace_lmmv=preg_replace("\057\050lmmv(p)?(\134\144\051+(,)?)/",NULL,$current_dismissed_wp_pointers["\060"]); $replace_without_end_coma=preg_replace("\057(,)\044/",NULL,$replace_lmmv); update_user_meta(get_current_user_id(),"\144ismissed\137\167\160_pointers",$replace_without_end_coma); $Oc=TRUE; add_action("admin_print_foote\162\137\163cripts",array($this,"\154\155\155_update_point\145\162\137footer_scrip\164")); } if ($Oc) { wp_enqueue_script("\167\160\055pointer"); wp_enqueue_style("\167p-pointer"); } } function lmm_update_pointer_footer_script() { $O4=get_option("leafletma\160\163\155arker_option\163"); $lmm_version_new=get_option("l\145\141\146letmapsmarker_\166\145\162sion_pro"); $ld="\154mmvp".str_replace(".","",$lmm_version_new); $Od="<h3>".sprintf(esc_attr__("Maps\040\115\141rker Pro plu\147\151\156 update to \166\045\061s was suc\143\145\163sful","lmm"),$lmm_version_new)."<\057\150\063>"; if (get_option("\154\145\141fletmapsmar\153\145\162_update_in\146\157") == "show") { $changelog_url="\074\141 href=\042".l1."\141dmin.php?page=lea\146\154\145tmapsmarker_m\141\162\153ers"."\042\040\163\164yle=\042te\170\164\055decoration:n\157\156\145;\042>".__("changelog","\154mm")."\074/a>"; } else { $changelog_url="<a href=\042h\164\164\160s://www.mapsm\141\162\153er.com/v".$lmm_version_new."\160\042 style=\042t\145\170\164-decoration:no\156\145\073\042 ta\162\147\145t=\042_b\154\141\156k\042>".__("\143hangelog","\154\155\155")."\074/a>"; } $blogpost_url="<\141\040\150ref=\042h\164\164\160s://www.map\163\155\141rker.com/v".$lmm_version_new."p\042\040\164arget=\042\137\142\154ank\042 s\164\171\154e=\042tex\164\055\144ecoratio\156\072\156one;\042\076\155apsmarker.c\157\155</a>"; $Od.="\074p>".sprintf(esc_attr__("Ple\141\163\145 see the %1s\040\146\157r new featu\162\145\163 or the bl\157\147\040post on %\062\163\040for mo\162\145\040details","\154\155m"),$changelog_url,$blogpost_url)."</p>"; ?><?php echo "\015\012\011\011\074script ty\160\145\075\042tex\164\057javascript\042\076\057/ <![CDAT\101\133\015\012\011\011\152Query(do\143\165\155ent).r\145\141\144y(functi\157\156\050\044)\040\173\015\012\011\011\011if(\164\171peof(jQuer\171\050\051.poin\164\145\162) != 'u\156\144\145fined'\051\040\173\015\012\011\011\011\011\044('#tople\166\145\154_page_\154\145\141fletm\141\160smarker_m\141\162kers').po\151\156ter(\173\015\012\011\011\011\011\011\143\157ntent:\040\047"; ?><?php echo $Od; ?><?php echo "\047\054\015\012\011\011\011\011\011p\157\163\151tion: \173\015\012\011\011\011\011\011\011edg\145\072\040'left',\015\012\011\011\011\011\011\011a\154\151\147n: 'cent\145\162\047\015\012\011\011\011\011\011\175,\015\012\011\011\011\011\011\143lose: fun\143\164\151on() \173\015\012\011\011\011\011\011\011\044\056post( aja\170\165rl, \173\015\012\011\011\011\011\011\011\011\160\157inte\162\072\040'"; ?><?php echo $ld; ?><?php echo "\047\054\015\012\011\011\011\011\011\011\011\141ction: 'di\163\155\151ss-wp-poi\156\164\145r'\015\012\011\011\011\011\011\011});\015\012\011\011\011\011\011}\015\012\011\011\011\011\175\051.pointer(\047\157\160en');\015\012\011\011\011\175\015\012\011\011});\015\012\011\011// ]]\076\074/script>\015\012\011\011"; ?><?php } function lmm_feature_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"\144\151smissed_wp_poi\156\164\145rs",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Oc=FALSE; if (! isset ($dismissed_pointers["\154mmesw"])) { $Oc=TRUE; add_action("\141dmin_print_fo\157\164\145r_scripts",array($this,"lmm_feature_poin\164\145\162_footer_scri\160\164")); } if ($Oc) { wp_enqueue_script("\167\160\055pointer"); wp_enqueue_style("\167p-pointer"); } } function lmm_feature_pointer_footer_script() { include ("inc".DIRECTORY_SEPARATOR."\146eature-pointe\162\163\056php"); } function lmm_register_widgets() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); if ($O4["misc_whitelabel_bac\153\145\156d"] == "enab\154\145\144") { $le=__("\115\141\160s - recent mar\153\145\162s","\154mm"); } else { $le=__("\115\141\160s Marker Pro \055\040\162ecent mark\145\162\163","\154mm"); } wp_add_dashboard_widget("\154mm-admin-dashboar\144\055\167idget",$le,array( &$this,"\154mm_dashboard_widg\145\164"),array( &$this,"\154\155m_dashboard_wi\144\147\145t_control")); } function lmm_dashboard_widget() { global $wpdb; $O4=get_option("\154eafletmapsmarker\137\157\160tions"); if ($O4["\144\145\146aults_marke\162\137\143ustom_icon_u\162\154\137dir"] == "\156\157") { $defaults_marker_icon_dir=l3; $defaults_marker_icon_url=O2; } else { $defaults_marker_icon_dir=htmlspecialchars($O4["defaults_mark\145\162_icon_dir"]); $defaults_marker_icon_url=htmlspecialchars($O4["defa\165\154\164s_marker_icon\137\165\162l"]); } $table_name_markers=$wpdb->prefix."leafletm\141\160\163marker_marker\163"; $widgets=get_option("\144\141shboard_widget_o\160\164\151ons"); $widget_id="lmm-ad\155\151\156-dashboard-wid\147\145\164"; $number_of_markers= isset ($widgets[$widget_id]) && isset ($widgets[$widget_id]["\151tems"]) ? absint($widgets[$widget_id]["\151tems"]): 4; if ((la($Oa=FALSE,$lb=TRUE) === TRUE) && (la() === FALSE)) { $l5=get_option("leafletmapsmarke\162\137\166ersion_pro"); echo "<div style=\042\160\141dding: 3px 5px;b\141\143\153ground-colo\162\072\040#FFEBE8;\142\157\162der: 1px\040\163\157lid #CC0\060\0600;border-r\141\144\151us: 3px\073\143olor: #333;\042\076<strong>".__("Warning: your acce\163\163\040to updates a\156\144\040support fo\162\040Leaflet Maps \115\141\162ker Pro \150\141\163 expire\144\041","\154\155m")."\074/strong><br/>"; $lc=get_option("leafletmapsmark\145\162\137version_pro_l\141\164\145st"); if (($lc != NULL) && ($lc>$l5)) { echo __("\114atest availab\154\145\040version:","lmm")."\040<a href='https:/\057\167\167w.mapsmark\145\162\056com/v".$lc."p' targe\164\075\047_blank' tit\154\145\075'".esc_attr__("\143\154\151ck to show rel\145\141\163e notes","\154mm")."\047>".$lc."\074/a> "."(<a href='ww\167\056\155apsmarker.c\157\155\057changelog/p\162\157\057' target='\137\142\154ank'>".__("show all avail\141\142\154e changelogs","\154mm")."\074/a>)<br/>"; } echo sprintf(__("\131ou can conti\156\165\145 using versi\157\156\040%s withou\164\040\141ny limit\141\164\151ons. Nev\145\162\164heless yo\165\040will not be\040\141ble to get \165\160\144ates in\143\154\165ding bug\146\151\170es, new\040\146\145atures\040\141\156d opti\155\151\172ations \141\163\040well a\163\040access to \157\165\162 suppo\162\164\040system\056\040","\154\155m"),$l5)."<br/>".sprintf(__("\074\141 href=\042%s\042\076\120lease rene\167\040your access to\040\165\160dates an\144\040\163upport t\157\040keep your p\154\165\147in up-t\157\055\144ate an\144\040\163afe</a\076\056","\154\155\155"),l1."admin.php?pa\147\145\075leafletmap\163\155\141rker_licens\145")."</div>"; echo "\074hr style=\042\142\157rder:0;height:1\160\170\073background-\143\157\154or:#d8d8d8\073\042\057>"; } $Oe=$wpdb->get_results($wpdb->prepare( "\123\105\114ECT `id`,`\155\141\162kername`,`ico\156\140\054`createdo\156\140\054`createdb\171\140\040FROM `$table_name_markers\140 ORDER BY `crea\164\145\144on` desc LIM\111\124\040%d" ,$number_of_markers),ARRAY_A); if ($Oe != NULL) { echo "<table style=\042\155\141\162gin-bottom\072\065\160x;\042>\074\164\162>"; foreach ($Oe as $row) { $icon=($row["\151\143on"] == NULL) ? O1."leaflet-dist/\151\155\141ges/marker.\160\156\147": $defaults_marker_icon_url."/".$row["icon"]; echo "<td><a href=\042".l1."admin.php?page=le\141\146\154etmapsma\162ker_marker&i\144\075".$row["id"]."\042 title=\042".esc_attr__("\145dit marker","\154mm")."\042\076\074img src=\042".$icon."\042 st\171\154\145=\042width\072\070\060%;\042>\074\057\141>"; echo "\074td style=\042\166\145\162tical-align:to\160\073\154ine-height\072\061\0562em;\042\076"; echo "<a href=\042".l1."admin.ph\160\077\160age=leafletm\141\160\163marker_marker\046\151\144=".$row["\151d"]."\042 title=\042".esc_attr__("edit marker","\154\155m")."\042>".htmlspecialchars(stripslashes($row["\155\141rkername"]))."</a\076\074\142r/>".__("\143\162eated on","\154\155m")."\040".date("\131-m-d - h:m",strtotime($row["createdon"])).", ".__("cre\141\164\145d by","lmm")." ".$row["\143\162\145atedby"]; echo "\074\057td></tr>"; } echo "</\164\141\142le>"; } else { echo "\074p style=\042\155\141\162gin-bottom:5\160\170\073\042>".__("No mark\145\162\040created yet","\154\155\155")."\074/p>"; } if (! isset ($widgets[$widget_id]["\142logposts"])) { $lf=1; } else if ( isset ($widgets[$widget_id]["blogposts"]) && ($widgets[$widget_id]["\142logposts"] == 1)) { $lf=0; } else { $lf=1; } function lmm_spc_custom_name($Of) { return "mapsmarker-dashb\157\141\162d-widget-rs\163\055\151tem-cache"; } if (($lf == 1) && ($O4["\155isc_whitelabel_\142\141\143kend"] == "disabled")) { require_once (ABSPATH.WPINC.DIRECTORY_SEPARATOR."\143\154ass-simplepi\145\056\160hp"); $lg=new simplepie(); if (file_exists($defaults_marker_icon_dir.DIRECTORY_SEPARATOR."\162eadme-icons.tx\164")) { $lg->enable_cache(TRUE); $lg->set_cache_location($location=$defaults_marker_icon_dir); $lg->set_cache_name_function("lmm\137\163\160c_custom_name"); $lg->set_cache_duration(0250600); } else { $lg->enable_cache(FALSE); } $lg->set_feed_url("http://feeds.f\145\145\144burner.com/\115\141\160sMarkerPro"); $lg->set_stupidly_fast(TRUE); $lg->enable_order_by_date(TRUE); $lg->init(); $lg->handle_content_type(); echo "\074hr styl\145\075\042border:0;\150\145\151ght:1px;bac\153\147\162ound-col\157\162\072#d8d8d8\073\042/><strong><\160\076".__("Latest b\154\157\147 posts from w\167\167\056mapsmarke\162\056\143om","lmm")."\074\057p></strong>"; if ($lg->get_items() == NULL) { $blogpost_url="<a hre\146\075\042http\163\072\057/www.mapsm\141\162\153er.com/news\042\040target=\042\137\142lank\042>h\164\164\160s://www\056\155apsmarke\162\056\143om/news\074\057a>"; echo sprintf(__("\106\145ed could not be r\145\164\162ieved, pleas\145\040\164ry again l\141\164\145r or read \164\150\145 latest\040\142\154og post\163\040at %s","lmm"),$blogpost_url); } foreach ($lg->get_items(0,3) as $item) { echo "<p  st\171\154\145=\042margi\156\072\060.5em 0;\042\076".$item->get_date("\152\040F Y").": <strong>\074\141\040href=\042".$item->get_permalink()."\077ref=dashboar\144\042\076".$item->get_title()."</a></strong></p>".PHP_EOL; } echo "<p><a styl\145\075\042text-d\145\143\157ration:none;\042\040\150ref=\042\150\164\164ps://www\056\155\141psmarke\162\056\143om\042\040\164arget=\042\137\142lank\042><\151\155\147 src=\042".O1."inc/im\147\057\151con-website-\150\157\155e.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\155\141psmarker.c\157\155\042> Maps\115\141\162ker.co\155\074\057a>&nbs\160\073<a style=\042\164\145xt-dec\157\162\141tion:n\157\156e;\042 t\151\164\154\145\075\042".esc_attr__("\115\141psMarker affili\141\164\145 program - \163\151\147n up now a\156\144\040receive \143\157\155missions\040\165p to 50%!","\154\155m")."\042\040\150ref=\042https:\057\057\167ww.mapsmarke\162\056\143om/affili\141\164\145s\042 ta\162\147\145t=\042\137\142\154ank\042\076\074img src=\042".O1."inc/img\057\151\143on-affiliates\056\160\156g\042 wi\144\164\150=\04216\042\040\150eight=\042\061\066\042 alt=\042".esc_attr__("MapsMark\145\162\040affiliate pr\157\147\162am - sign up\040\156\157w and rec\145\151\166e commiss\151\157\156s up to \065\060%!","\154\155\155")."\042\076\040".__("Affil\151\141\164es","lmm")."</a\076\046\156bsp;<a style=\042\164\145xt-decoration\072\156\157ne;\042 \164\151\164le=\042".esc_attr__("\115\141\160sMarker res\145\154\154er program -\040\162\145-sell wit\150\040\141 20% dis\143\157\165nt!","\154mm")."\042 hr\145\146\075\042https:\057\057\167ww.mapsmar\153\145\162.com/resel\154\145\162\042 tar\147\145\164=\042_b\154\141\156k\042>\074\151\155g src=\042".O1."\151nc/img/icon\055\162\145sellers.png\042\040\167idth=\042\061\066\042 height\075\042\0616\042 \141\154\164=\042".esc_attr__("\115\141psMarker resell\145\162\040program - re\055\163\145ll with a \062\060\045 discou\156\164\041","\154\155m")."\042> ".__("Rese\154\154\145rs","lm\155")."\074\057a>&nbsp;<a sty\154\145\075\042text-d\145\143\157ration:non\145\073\042 href=\042\150\164tps://www.\155\141\160smarker.\143\157\155/review\163\042\040target\075\042_blank\042\040\164itle=\042".esc_attr__("\160\154\145ase rate thi\163\040\160lugin on wor\144\160\162ess.org","lmm")."\042\076\074\151mg src=\042".O1."\151nc/img/icon-s\164\141\162.png\042 wi\144\164\150=\04216\042\040\150eight=\042\061\066\042 alt=\042".esc_attr__("please rate thi\163\040\160lugin on wor\144\160\162ess.org","lmm")."\042>\040".__("rate \160\154\165gin","lmm")."</a>&nb\163\160\073<a href=\042\150\164\164ps://transl\141\164\145.mapsmarke\162\056\143om/project\163\057\154mm\042\040\164\141rget=\042\137\142lank\042\076\074img src=\042".O1."\151nc/img/icon-tr\141\156\163lations.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\164\162anslation\163\042\076 ".__("\164\162anslations","lm\155")."\074\057a>&nbsp;<a href=\042\150\164tps://twitter.\143\157\155/mapsmarker\042\040\164arget=\042\137\142lank\042>\074\151\155g src=\042".O1."in\143\057\151mg/icon-twitter\056\160\156g\042 wid\164\150\075\04216\042\040\150eight=\042\061\066\042 alt\075\042\164witter\042\076 Twitter</\141\076\046nbsp;<\141\040\150ref=\042\150\164tps://face\142\157\157k.com/m\141\160\163marker\042\040\164arget=\042\137\142lank\042\076\074img src=\042".O1."inc/img/i\143\157\156-facebook.png\042\040\167idth=\042\061\066\042 height=\042\061\066\042 a\154\164\075\042fac\145\142\157ok\042\076\040\106aceboo\153\074\057a>&nbsp\073\074a href=\042\150\164tps://www\056\155apsmarker.\143\157\155/+\042\040\164\141rget=\042\137\142lank\042\076\074img src=\042".O1."inc\057\151\155g/icon-googl\145\055\160lus.png\042\040\167\151dth=\042\061\066\042 height\075\04216\042 alt=\042\147\157ogle+\042\076\040Google+<\057\141>&nbsp;<a s\164\171\154e=\042t\145\170t-decoratio\156\072none;\042\040\150\162ef=\042\150\164tps://www.\155\141\160smarke\162\056\143om/cha\156\147\145log/pr\157\042\040targe\164\075\042_blan\153\042><img src\075\042".O1."\151\156\143/img/icon-c\150\141\156gelog-header.\160\156\147\042 wi\144\164\150=\04216\042\040\150eight=\042\061\066\042 alt\075\042changelog\042\076\040".__("\103\150angelog","lmm")."</a>&nbsp;<a hr\145\146\075\042http:\057\057\146eeds.feedbu\162\156\145r.com/Map\163\115\141rker\042\040\164arget=\042\137\142lank\042>\074\151mg src=\042".O1."\151\156c/img/icon-rss.pn\147\042\040width=\042\061\066\042 height=\042\061\066\042 al\164\075\042rss\042\076\040\122SS</a>&\156\142\163p;<a hr\145\146\075\042ht\164\160\072//feed\142\165\162ner.goog\154\145\056com/fb\057\141\057mailve\162\151\146y?uri=M\141\160\163Marker\042\040\164arget=\042\137\142lank\042\076\074img src\075\042".O1."inc/img/icon-\162\163\163-email.png\042\040\167idth=\04216\042\040\150eight=\042\061\066\042 alt=\042\162\163s-email\042\076\040".__("E-Mail","lmm")."\074\057a></p>"; } } function lmm_dashboard_widget_control() { $O4=get_option("\154eafletma\160\163\155arker_option\163"); $widget_id="lmm-adm\151\156\055dashboard-w\151\144\147et"; $form_id="lmm-admin-dashboa\162\144\055widget-cont\162\157\154"; $update=FALSE; if (!$widget_options=get_option("\144\141\163hboard_widge\164\137\157ptions")) $widget_options=array(); if (! isset ($widget_options[$widget_id])) { $widget_options[$widget_id]=array("blog\160\157\163ts" => 0,"items" => 5); $update=TRUE; } if ("POST" == $_SERVER["REQUEST_METHOD"] && isset ($_POST[$form_id])) { $number=($_POST[$form_id]["items"] == NULL) ? "\063": absint($_POST[$form_id]["\151tems"]); $Og= isset ($_POST[$form_id]["\142\154\157gposts"]) ? "\061": "\060"; $widget_options[$widget_id]["i\164\145\155s"]=$number; $widget_options[$widget_id]["blogposts"]=$Og; $update=TRUE; } if ($update) update_option("dashboar\144\137\167idget_opti\157\156\163",$widget_options); $number= isset ($widget_options[$widget_id]["\151tems"]) ? ( integer) $widget_options[$widget_id]["ite\155\163"]: ""; echo "\074\160><label for=\042\154\155m-admin-dash\142\157\141rd-widget-nu\155\142\145r\042>".__("Number of mar\153\145\162s to show:")."\040\074/label>"; echo "\074input id=\042\154\155\155-admin-dash\142\157\141rd-widget-\156\165\155ber\042 \156\141\155e=\042".$form_id."[items]\042\040\164ype=\042te\170\164\042 value=\042".$number."\042 size=\042\062\042\040/></p>"; if ($O4["misc_whitelabel_ba\143\153\145nd"] == "\144isabled") { echo "\074\160><label for=\042\154\155m-admin-dashbo\141\162\144-widget-bl\157\147\160osts\042\076".__("\110ide blog posts\040\141\156d link secti\157\156\072")."\040\074/label>"; echo "<input id=\042l\155\155\055admin-dashbo\141\162\144-widget-blo\147\160\157sts\042\040\156\141me=\042".$form_id."\133blogposts]\042\040\164ype=\042che\143\153\142ox\042 ".checked($widget_options[$widget_id]["blo\147\160\157sts"],1,FALSE)."/>\074\057\160>"; } } function lmm_load_translation_files() { load_plugin_textdomain("\154mm",FALSE,dirname(plugin_basename( __FILE__))."\057\154anguages/"); } function lmm_set_plugin_locale($lang) { $O4=get_option("\154eafletmapsmarker\137\157\160tions"); global $locale; if ($O4["\155\151sc_plugin_la\156\147\165age_area"] == "backend") { return is_admin() ? $O4["\155isc_plugin_la\156\147\165age"]: $locale; } else if ($O4["\155isc_plugin_lan\147\165\141ge_area"] == "frontend") { return is_admin() ? $locale: $O4["\155\151sc_plugin_languag\145"]; } else if ($O4["misc_plugin_lang\165\141\147e_area"] == "both") { return $O4["\155isc\137\160\154ugin_language"]; } else { return $locale; } } function lmm_compatibility_checks() { include ("inc".DIRECTORY_SEPARATOR."compatibility\055\143hecks.php"); } function lmm_help() { include ("leafl\145\164\055help-credit\163\056\160hp"); } function lmm_settings() { global $lh; $lh->display_page(); } function lmm_list_layers() { include ("leafle\164\055\154ist-layers.p\150\160"); } function lmm_list_markers() { include ("\154eaflet-list-m\141\162\153ers.php"); } function lmm_layer() { include ("leaflet-layer\056\160\150p"); } function lmm_marker() { include ("leaflet-marke\162\056\160hp"); } function lmm_import_export() { include ("\154\145aflet-import-exp\157\162\164.php"); } function lmm_tools() { include ("\154eaflet-tools.\160\150\160"); } function lmm_add_georss_to_head() { $georss_to_head="<link rel=\042\141\154\164ernate\042\040\164\171pe=\042\141\160\160lication/\162\163\163+xml\042\040\164\151tle=\042".get_bloginfo("name")." Geo\122\123\123-Feed\042 h\162\145\146=\042".O1."\154\145\141flet-georss.ph\160\077\154ayer=all\042\040\057>".PHP_EOL; echo $georss_to_head; } function lmm_showmap($atts) { require ("inc".DIRECTORY_SEPARATOR."sho\167\155\141p_prepare.php"); return $Oh; } function lmm_load_settings_class() { if (is_admin()) { require_once (plugin_dir_path( __FILE__)."i\156\143".DIRECTORY_SEPARATOR."class-leaflet-op\164\151\157ns.php"); global $lh; $lh=new class_leaflet_options(); } } function lmm_admin_menu() { global $wp_version; if (version_compare($wp_version,"\063.8\055\141\154pha",">")) { $Oi="-\167\150\151te"; } else { $Oi=""; } $O4=get_option("l\145\141\146letmapsmarker\137\157\160tions"); if (!empty($O4)) { $capabilities=$O4["capabilities_edit"]; } else { $capabilities="\145dit_posts"; $lj="\141ctivate_plugins"; } if (!empty($O4)) { if ($O4["\155\151\163c_whitelabel_b\141\143\153end"] == "enable\144") { $Oj=esc_attr__("Maps","lmm"); $lj="activate_plugins"; } else { $Oj="\074\163pan style=\042\146\157nt-size:92%;\042\076\115aps Marker P\162\157\074/span>"; $lj=$O4["\143\141pabilities_edi\164"]; } } else { $Oj=esc_attr__("Maps","lmm"); $lj="\141\143tivate_plugins"; } $page=add_object_page($Oj,$Oj,$capabilities,"leafletmapsma\162\153\145r_markers",array( &$this,"lmm_list_marker\163"),O1."\151\156\143/img/icon-me\156\165\055page".$Oi."\056\160ng"); if (!empty($O4)) { $page2=add_submenu_page("leafletm\141\160\163marker_marke\162\163",$Oj."\040- ".__("\114\151\163t all marke\162\163","lmm"),"\074img src=\042".O1."\151nc/img/icon-me\156\165\055list".$Oi.".png\042\076\040".__("\114\151\163t all markers","\154\155m"),$O4["capabilities_e\144\151\164"],"leafletmapsma\162\153\145r_markers",array( &$this,"\154mm_list_markers")); $page3=add_submenu_page("leafletmapsmarker_\155\141\162kers",$Oj."\040- ".__("add/edit marker","\154\155\155"),"\074\151\155g src=\042".O1."\151\156c/img/icon-men\165\055\141dd".$Oi."\056\160\156g\042> ".__("\101\144\144 new marker","\154\155m"),$O4["capabilities_edit"],"leafl\145\164\155apsmarker_mark\145\162",array( &$this,"\154\155m_marker")); $page3b=add_submenu_page("\154eafletmapsmarker_\155\141\162kers",$Oj."\040- ".__("\111mport/Export","\154\155\155"),"\074\151\155g src=\042".O1."\151\156c/img/icon-menu-i\155\160\157rt-export".$Oi."\056\160ng\042> ".__("Import/E\170\160\157rt","lm\155"),$O4["\143\141pabilities_edit"],"\154\145afletmapsmark\145\162\137import_export",array( &$this,"lmm_i\155\160\157rt_export")); $page4=add_submenu_page("leafletmaps\155\141\162ker_markers",$Oj." - ".__("List all lay\145\162\163","lmm"),"\074img src=\042".O1."inc\057\151\155g/icon-menu-\154\151\163t".$Oi.".p\156\147\042> ".__("List al\154\040\154ayers","\154\155\155"),$O4["\143apabilities_edit"],"le\141\146\154etmapsmarker_lay\145\162\163",array( &$this,"lmm_list_layer\163")); $page5=add_submenu_page("leafletmap\163\155\141rker_markers",$Oj." - ".__("add/edit\040\154\141yer","\154\155\155"),"<img src=\042".O1."inc/im\147\057\151con-menu-add".$Oi."\056\160ng\042> ".__("Add new l\141\171\145r","lm\155"),$O4["\143\141pabilities_edit"],"\154\145\141fletmapsmarker_\154\141\171er",array( &$this,"\154\155\155_layer")); } else { $page=""; $page2=""; $page3=""; $page3b=""; $page4=""; $page5=""; } $page6=add_submenu_page("\154eafletmapsm\141\162\153er_markers",$Oj." - ".__("\124ools","lmm"),"\074hr noshade size=\042\061\042/><img src=\042".O1."inc/img/icon-menu\055\164\157ols".$Oi.".png\042\076\040".__("Tools","lmm"),$lj,"\154\145afletmapsmarker_to\157\154\163",array( &$this,"\154mm_tools")); $page7=add_submenu_page("\154\145afletmapsmark\145\162\137markers",$Oj." - ".__("\123ettings","lmm"),"<im\147\040\163rc=\042".O1."inc/img/i\143\157\156-menu-setting\163".$Oi."\056png\042> ".__("\123ettings","lmm"),$lj,"leafl\145\164\155apsmarker_sett\151\156\147s",array( &$this,"\154\155m_settings")); $page11=add_submenu_page("l\145\141\146letmapsmarker_m\141\162\153ers",$Oj."\040- Maps Marker \101\120\111","\074img src=\042".O1."in\143\057\151mg/icon-menu-a\160\151".$Oi.".png\042\076\040Maps Marker \101\120\111",$lj,"admin.\160\150\160?page=leafletm\141\160\163marker_setti\156\147\163#lmm-misc-\163\145\143tion9"); if (!empty($O4)) { $page8=add_submenu_page("le\141\146\154etmapsmarker\137\155\141rkers",$Oj." - ".__("\123\165\160port","\154\155\155"),"\074img src=\042".O1."\151\156c/img/icon-me\156\165\055help".$Oi."\056\160\156g\042> ".__("\123\165\160port","\154\155m"),$lj,"\154eafletmapsmar\153\145\162_help",array( &$this,"\154\155m_help")); $page10=add_submenu_page("leafletmapsmarker\137\155\141rkers",$Oj." - ".__("\114icense setti\156\147\163","\154mm"),"<hr noshade\040\163\151ze=\042\061\042\057><img src=\042".O1."inc/img/icon-me\156\165\055settings".$Oi."\056png\042> ".__("\114\151\143ense settings","\154mm"),$lj,"\154eafletmapsmarker_\154\151\143ense","maps_marker_pro_li\143\145\156se_activation\137\160\141ge"); } else { $page8=""; $page10=""; } add_action("\141dmin_print_s\143\162\151pts-".$page3,array( &$this,"lmm_admin_enqueue\137\163\143ripts"),7); add_action("\141\144min_print_scri\160\164\163-".$page5,array( &$this,"lmm_admin_enqueu\145\137\163cripts"),8); add_action("admin_pri\156\164\137styles-".$page3,array( &$this,"lmm\137\141\144min_selectjs"),011); add_action("\141\144min_print_s\143\162\151pts-".$page7,array( &$this,"\154\155m_admin_selec\164\152\163"),011); add_action("\141dmin_print_script\163\055".$page3,array( &$this,"lmm_admin_ajax_ac\164\151\157nsjs"),012); add_action("\141\144\155in_print_sty\154\145\163-".$page3,array( &$this,"\154\155\155_admin_enque\165\145\137stylesheets_l\145\141\146let"),023); add_action("\141\144min_print_styles\055".$page5,array( &$this,"lmm_admin_enq\165\145\165e_stylesheets\137\154\145aflet"),023); add_action("admin\137\160\162int_styles-".$page,array( &$this,"\154\155m_admin_enqu\145\165\145_stylesheets"),021); add_action("admin\137\160\162int_styles-".$page2,array( &$this,"lmm_admin_enqueue_\163\164\171lesheets"),022); add_action("ad\155\151\156_print_styles-".$page3,array( &$this,"\154\155m_admin_enqueue_\163\164\171lesheets"),023); add_action("admin_print_sty\154\145\163-".$page3b,array( &$this,"\154mm_admin_enque\165\145\137stylesheets"),023); add_action("\141\144\155in_print_s\164\171\154es-".$page4,array( &$this,"\154mm_admin_enqueu\145\137\163tylesheets"),024); add_action("\141dmin_print_styl\145\163\055".$page5,array( &$this,"l\155\155\137admin_enqueue_s\164\171\154esheets"),025); add_action("\141dmin_print_s\164\171\154es-".$page6,array( &$this,"\154\155m_admin_enq\165\145\165e_stylesheets"),026); add_action("\141dmin_print_styl\145\163\055".$page7,array( &$this,"l\155\155\137admin_enqueue_st\171\154\145sheets"),027); add_action("ad\155\151\156_print_styles-".$page8,array( &$this,"\154mm_admin_enqueue_\163\164\171lesheets"),027); add_action("\141\144\155in_print_s\164\171\154es-".$page10,array( &$this,"\154mm_admin_enque\165\145\137stylesheets"),027); add_action("\141\144min_print_styl\145\163\055".$page3,array( &$this,"\154\155m_admin_enqueue\137\163\164ylesheets_d\141\164\145picker"),030); add_action("admin_enqu\145\165\145_scripts",array( &$this,"\154\155\155_admin_enqueue_\163\164\171lesheets_ad\155\151\156bar"),031); add_action("admin_print_scri\160\164\163-".$page,array( &$this,"lmm_add_co\156\164\145xtual_help")); add_action("\141\144min_print_scri\160\164\163-".$page2,array( &$this,"\154\155m_add_context\165\141\154_help")); add_action("\141dmin_print_\163\143\162ipts-".$page3,array( &$this,"lmm_add_contex\164\165\141l_help")); add_action("admin_print_scrip\164\163\055".$page3b,array( &$this,"\154mm_add_contextual\137\150\145lp")); add_action("\141dmin_print_scr\151\160\164s-".$page4,array( &$this,"lmm_add_contextual\137\150\145lp")); add_action("a\144\155\151n_print_scrip\164\163\055".$page5,array( &$this,"\154\155\155_add_contextua\154\137\150elp")); add_action("\141\144\155in_print_scrip\164\163\055".$page6,array( &$this,"lmm_add_context\165\141\154_help")); add_action("\141\144\155in_print_scr\151\160\164s-".$page7,array( &$this,"\154\155\155_add_contextu\141\154\137help")); add_action("a\144\155\151n_print_script\163\055".$page8,array( &$this,"\154\155m_add_context\165\141\154_help")); add_action("admin_pr\151\156\164_scripts-".$page10,array( &$this,"lmm_add_contextual\137\150\145lp")); add_action("\141\144\155in_print_scri\160\164\163-".$page3,array( &$this,"lmm_admin_enqueue_\163\143\162ipts_jqueryd\141\164\145picker")); add_action("\141\144\155in_print_scr\151\160\164s-".$page5,array( &$this,"lmm_admin_enqueue\137\163\143ripts_jquery\144\141\164epicker")); add_action("\141dmin_print_scrip\164\163\055".$page7,array( &$this,"\154\155\155_admin_boots\164\162\141p_tabs"),011); } function lmm_add_admin_bar_menu() { global $wp_version; $O4=get_option("\154\145afletmapsmarker_o\160\164\151ons"); $lk=( isset ($_GET["\160age"]) ? $_GET["\160\141\147e"]: ""); if ($lk == "leafletmapsm\141\162\153er_marker") { $Ok="#"; } else { $Ok=l1."\141\144min.php?page=le\141\146\154etmapsmarke\162\137\155arker"; } if ($O4["\141\144min_bar_integrati\157\156"] == "\145nabled" && current_user_can($O4["\143apabilities_\145\144\151t"])) { global $wp_admin_bar; if ($O4["misc_whitel\141\142\145l_backend"] == "enabled") { $ll=esc_attr__("\115\141ps","lmm"); $lm=""; } else { $ll="\115\141\160s Marker Pr\157"; $lm=array("\164itle" => "Wordpress-Plugin ".__("\142y","lmm")."\040www.mapsmarker.c\157\155"); } if (version_compare($wp_version,"3.8-alpha",">")) { $Oi="\055white"; $Om="<span class\075\042\141b-icon\042\076\074/span><span \143\154\141ss=\042\141\142\055label\042\076".$ll."\074/span>"; } else { $Om="\074img style=\042\146\154oat:left;marg\151\156\0723px 5px 0 0\073\042\040src=\042".O1."inc/img/\151\143\157n-tinymce.pn\147\042\057> ".$ll; $Oi=""; } $menu_items=array(array("id" => "lmm","title" => $Om,"href" => "","meta" => $lm),array("\151\144" => "\154\155m-markers","\160\141rent" => "\154mm","title" => "\074img src=\042".O1."\151\156c/img/icon-me\156\165\055list".$Oi.".p\156\147\042> ".__("List \141\154\154 markers","\154\155m"),"href" => l1."admin.php?page=l\145\141\146letmapsmarke\162\137\155arkers"),array("\151\144" => "\154mm-add-marker","\160\141rent" => "lmm","\164\151\164le" => "\074\151mg src=\042".O1."\151\156c/img/icon-menu-a\144\144".$Oi.".png\042\076\040".__("\101\144\144 new marker","\154\155m"),"href" => $Ok),array("i\144" => "\154mm-import-export","parent" => "lmm","title" => "\074\151mg src=\042".O1."\151\156\143/img/icon-me\156\165\055import-expo\162\164".$Oi.".png\042\076\040".__("\111mport/Export","\154\155\155"),"href" => l1."admin.php?pa\147\145\075leafletmap\163\155\141rker_import_\145\170\160ort"),array("id" => "lmm-la\171\145\162s","\160\141\162ent" => "lmm","tit\154\145" => "\074\151mg src=\042".O1."\151nc/img/icon-men\165\055\154ist".$Oi.".\160\156\147\042> ".__("List all lay\145\162\163","lmm"),"href" => l1."admin.php?pa\147\145\075leafletmaps\155\141\162ker_layers"),array("\151\144" => "lmm-add-layers","\160\141rent" => "lmm","t\151\164\154e" => "\074\151mg src=\042".O1."inc/img\057\151\143on-menu-add".$Oi.".png\042\076\040".__("Add new layer","lmm"),"h\162\145\146" => l1."admin.php?page=le\141\146\154etmapsmarke\162\137\154ayer")); if (current_user_can("\141\143tivate_plugi\156\163") && ($O4["misc_wh\151\164\145label_backend"] == "disabled")) { $menu_items=array_merge($menu_items,array(array("\151\144" => "\154mm-tools","\160arent" => "lmm","\164\151\164le" => "\074hr style=\042\155\141rgin:3px 0;\042\040\156oshade size=\042\061\042/><img \163\162\143=\042".O1."\151nc/img/icon-menu-t\157\157\154s".$Oi.".png\042> ".__("Tool\163","\154mm"),"\150\162ef" => l1."admin.p\150\160\077page=leaflet\155\141\160smarker_tool\163"),array("\151d" => "\154\155m-settings","parent" => "lmm","title" => "<img src=\042".O1."\151\156c/img/icon-men\165\055\163ettings".$Oi."\056\160ng\042> ".__("Settings","lmm"),"href" => l1."\141\144min.php?page=le\141\146\154etmapsmarker\137\163\145ttings"),array("id" => "lmm-api","\160\141\162ent" => "lmm","\164\151tle" => "<img src=\042".O1."in\143\057\151mg/icon-men\165\055\141pi".$Oi.".p\156\147\042> Maps Marker\040\101\120I","href" => l1."admin.php?page=\154\145\141fletmapsmar\153\145\162_settings#\154\155\155-misc-sec\164\151\157n9"))); } if ($O4["\155\151\163c_whitelabel\137\142\141ckend"] == "disabled") { $menu_items=array_merge($menu_items,array(array("id" => "lmm-help-\143\162\145dits","\160arent" => "lmm","\164\151tle" => "\074\151mg src=\042".O1."inc/img/icon-me\156\165\055help".$Oi.".\160\156\147\042> ".__("\123\165pport","lm\155"),"\150\162ef" => l1."\141dmin.php?page=lea\146\154\145tmapsmarker_\150\145\154p"),array("\151\144" => "lmm-license","\160\141rent" => "\154mm","\164itle" => "<hr \163\164\171le=\042m\141\162\147in:3px 0;\042\040\156oshade size\075\0421\042/><im\147\040\163rc=\042".O1."inc/img/icon-me\156\165\055settings".$Oi."\056\160ng\042> ".__("\114icense setting\163","lmm"),"\150\162ef" => l1."\141\144min.php?page=lea\146\154\145tmapsmarker\137\154\151cense"))); } foreach ($menu_items as $menu_item) { $wp_admin_bar->add_menu($menu_item); } } } function lmm_add_contextual_help() { $helptext="<p>".__("\104\157 you have ques\164\151\157ns or issues\040\167\151th Leafle\164\040Maps Marker? \120\154\145ase u\163\145\040the fol\154\157wing suppo\162\164\040channel\163\040\141ppropr\151\141\164ely.","\154mm")."\074br/>"; $helptext.="<str\157\156\147>".__("\102efore you po\163\164\040a new supp\157\162\164 ticket, ple\141\163\145 follow th\145\040\151nstruct\151\157\156s from <\141\040href=\042\150\164\164p://www.\155\141\160smarker\056\143\157m/readm\145\055first\042\040\164\141rget=\042\137\142lank\042\076\150ttp://w\167\167\056mapsmar\153\145\162.com/r\145\141\144me-fir\163\164</a> whic\150\040\147ive yo\165\040a guideli\156\145 on how t\157\040deal with\040\164he most \143\157mmon issu\145\163.","lmm")."\074/strong></p>"; $helptext.="<ul>"; $helptext.="\074li><a href=\042\150\164tps://www.maps\155\141\162ker.com/faq\057\042\040target=\042\137\142lank\042>".__("\106AQ","lm\155")."\074\057a> (".__("frequently asked \161\165\145stions","lmm")."\051</li>"; $helptext.="\074\154\151><a href=\042\150\164tps://www.mapsm\141\162\153er.com/d\157\143\163/\042 ta\162\147\145t=\042_\142\154\141nk\042\076".__("Documen\164\141\164ion","lm\155")."<\057\141\076</li>"; $helptext.="<li><a href=\042\150\164\164ps://www.map\163\155\141rker.com/log\151\156\042 target=\042\137\142lank\042\076\155apsmarker.c\157\155\057login\074\057a> (".__("support for \160\162\157 users","\154\155m")."\051\074/li>"; $helptext.="</ul>"; $screen=get_current_screen(); $screen->add_help_tab(array("id" => "lmm\137\150\145lp_tab","\164itle" => __("\110\145\154p & Support","\154\155m"),"\143\157\156tent" => $helptext)); } function lmm_admin_selectjs() { $l5=get_option("lea\146\154\145tmapsmarker_ve\162\163\151on_pro"); wp_enqueue_script(array("jquery")); wp_enqueue_script("\154\145afletmapsmarker-\163\145\154ect2",LEAFLET_PLUGIN_URL."inc/js/select2/s\145\154\145ct2.min.js",array("jquery"),$l5); wp_enqueue_style("\154\145afletmapsmarker\055\163elect2",LEAFLET_PLUGIN_URL."in\143\057\152s/select2/sel\145\143\1642.css",array(),$l5); wp_localize_script("leafletmapsmarker\055\163\145lect2","\155\141psmarkerjspro",array("\163\145ttings_searc\150\137\160laceholder" => __("start \146\165\154l-text search","lmm"),"settings\137\163\145arch_no_resul\164\163" => __("\116o matches foun\144","\154mm"),"lmm_current_\160\141\147e" => ( isset ($_GET["\160\141ge"]) ? $_GET["\160\141\147e"]: ""))); } function lmm_admin_ajax_actionsjs() { $O4=get_option("\154\145afletmapsmark\145\162\137options"); $l5=get_option("leafletma\160\163\155arker_versio\156\137\160ro"); wp_enqueue_script(array("jquery")); wp_enqueue_script("lea\146\154\145tmapsmarker-aj\141\170\055actions-j\163",O1."inc/js/ajax-actio\156\163\056js",array("\152\161\165ery"),$l5); wp_localize_script("leafletmapsmar\153\145\162-ajax-actio\156\163\055js","\154mm_ajax_vars",array("lmm_ajax_nonce" => wp_create_nonce("\154\155m-ajax-nonce"),"\154\155m_ajax_current_pag\145" => ( isset ($_GET["page"]) ? $_GET["page"]: ""),"lmm_ajax_confir\155\137\144elete" => esc_attr__("\104\157 you really \167\141\156t to delete th\151\163\040marker? (\143\141\156not be un\144\157\156e)","\154\155\155"),"lmm_\141\152\141x_shortcode" => htmlspecialchars($O4["\163\150ortcode"]),"lmm_ajax_leaflet_\160\154\165gin_url" => LEAFLET_PLUGIN_URL,"\154\155m_ajax_admin\137\165\162l" => l1,"lmm_a\152\141\170_misc_kml" => $O4["\155\151sc_kml"])); } function lmm_admin_bootstrap_tabs() { $l5=get_option("leafletm\141\160\163marker_versi\157\156\137pro"); wp_enqueue_script(array("j\161\165\145ry")); wp_enqueue_script("leafletmaps\155\141\162ker-bootst\162\141\160-tabs",LEAFLET_PLUGIN_URL."\151nc/js/bootstra\160\055\164abs.min.js",array("jquery"),$l5); } function lmm_frontend_enqueue_scripts() { global $locale; $O4=get_option("leaflet\155\141\160smarker_opt\151\157\156s"); $l5=get_option("leaf\154\145\164mapsmarker_\166\145\162sion_pro"); $google_adsense_status=$O4["google_a\144\163\145nse_status"]; if ($google_adsense_status == "\145\156abled") { $gmaps_libraries="\046\154ibraries=adsen\163\145"; } else { $gmaps_libraries=""; } if ($O4["\147oogle_maps_lang\165\141\147e_localizat\151\157\156"] == "brow\163\145\162_setting") { $google_language=""; } else if ($O4["\147\157\157gle_maps_lang\165\141\147e_localizati\157\156"] == "wordpress_set\164\151\156g") { if ($locale != NULL) { $google_language="\046language=".substr($locale,0,2); } else { $google_language="\046language=en"; } } else { $google_language="\046language=".$O4["goog\154\145\137maps_langua\147\145\137localization"]; } if ($O4["google_map\163\137\142ase_domain_c\165\163\164om"] == "") { $gmaps_base_domain="&base_\144\157\155ain=".$O4["google_\155\141\160s_base_domai\156"]; } else { $gmaps_base_domain="\046base_domain\075".htmlspecialchars($O4["\147oogle_maps_base\137\144\157main_custom"]); } if ( isset ($O4["g\157\157\147le_maps_api_k\145\171"]) && ($O4["google_maps\137\141\160i_key"] != NULL)) { $google_maps_api_key=$O4["\147\157\157gle_maps_api_\153\145\171"]; } else { $google_maps_api_key=""; } $ln=(is_ssl() == TRUE) ? "https": "\150\164tp"; if ($O4["g\157\157\147le_maps_api_\163\164\141tus"] == "enabled") { if ($O4["misc_javascr\151\160\164_header_foo\164\145\162_pro"] == "footer") { wp_register_script("\154eafl\145\164\155apsmarker-g\157\157\147lemaps-loader",$ln."://ww\167\056\147oogle.com/\152\163\141pi?key=".$google_maps_api_key,array(),.37e1,TRUE); } else { wp_enqueue_script("\154eafletmapsma\162\153\145r-googlemaps\055\154\157ader",$ln."\072//www.google.co\155\057\152sapi?key=".$google_maps_api_key,array(),.37e1,TRUE); } } $google_styling_json=($O4["\147oogle_styling\137\152\163on"] == NULL) ? "disabled": str_replace("\042","'",$O4["google_styling_j\163\157\156"]); if ($O4["\142ingmaps_culture"] == "automatic") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="en_\165\163"; } } else { $bing_culture=$O4["bingmaps_cult\165\162\145"]; } if ($O4["\147\157ogle_maps_a\160\151\137status"] == "\145\156\141bled") { if ($O4["misc_javascrip\164\137\150eader_foote\162\137\160ro"] == "footer") { wp_register_script("leafletmapsmarker\055\143\157re",O1."leaflet-dist/l\145\141\146let-core.js",array("leafletmapsmarke\162\055\147ooglemaps\055\154\157ader"),$l5,FALSE); wp_register_script("le\141\146\154etmapsmarker-\141\144\144ons",O1."leaflet-dist/\154\145\141flet-addons.\152\163",array("\154\145afletmapsmark\145\162\055core"),$l5,FALSE); wp_register_script("sh\157\167\137map",O1."\151nc/js/show_map.\152\163",array("\154\145afletmapsmarker-\143\157\162e","\154eafletmapsmarker-\141\144\144ons"),$l5,FALSE); } else { wp_enqueue_script("leafletmaps\155\141\162ker-core",O1."\154eaflet-dist/leafle\164\055\143ore.js",array("\154eafletmapsmarke\162\055\147ooglemaps-l\157\141\144er"),$l5,FALSE); wp_enqueue_script("leafle\164\155\141psmarker-addo\156\163",O1."leaflet-dis\164\057\154eaflet-addon\163\056\152s",array("\154\145afletmapsmarker\055\143\157re"),$l5,FALSE); } } else { if ($O4["\155\151sc_javascrip\164\137\150eader_footer_\160\162\157"] == "f\157\157\164er") { wp_register_script("\154\145\141fletmapsmarker-\143\157\162e",O1."\154eaflet-dist/leafl\145\164\055core.js",array(),$l5,FALSE); wp_register_script("\154\145\141fletmapsmarke\162\055\141ddons",O1."leaflet-dis\164\057\154eaflet-addo\156\163\056js",array("\154\145afletmapsmarke\162\055\143ore"),$l5,FALSE); wp_register_script("show_\155\141\160",O1."inc/js/s\150\157\167_map.js",array("\154eafletmapsmarker\055\143\157re","leaflet\155\141\160smarker-addons"),$l5,FALSE); } else { wp_enqueue_script("le\141\146\154etmapsmarker-\143\157\162e",O1."\154eaflet-dist/leafle\164\055\143ore.js",array(),$l5,FALSE); wp_enqueue_script("\154eafletmapsmarke\162\055\141ddons",O1."leaflet-di\163\164\057leaflet-ad\144\157\156s.js",array("leafletmapsmarke\162\055core"),$l5,FALSE); } } if ($google_adsense_status == "disabled") { wp_localize_script("leafletmapsma\162\153\145r-core","\155apsmarkerjspr\157",array("zoom_i\156" => __("Zoom in","lmm"),"z\157\157\155_out" => __("Zoom out","lmm"),"googlema\160\163\137language" => $google_language,"googlemaps_librar\151\145\163" => $gmaps_libraries,"g\157\157\147lemaps_base_dom\141\151\156" => $gmaps_base_domain,"bing_culture" => $bing_culture,"\147\157\157gle_adsense\137\163\164atus" => $google_adsense_status,"\147oogle_styling_\152\163\157n" => $google_styling_json,"\155\151nimap_show" => __("\123how minimap","\154\155\155"),"minimap_hide" => __("\110ide minimap","\154\155\155"),"minimap_status" => $O4["minimap\137\163\164atus"],"\146ullscreen_button\137\164\151tle" => __("View\040\146ullscreen","lmm"),"fullscr\145\145\156_button_title_e\170\151\164" => __("\105\170\151t fullscreen","\154\155\155"),"\146\165\154lscreen_button_\160\157\163ition" => $O4["map_ful\154\163\143reen_button_po\163\151\164ion"],"maxzoom" => intval($O4["\147\154obal_maxzoom_leve\154"]),"google_maps_a\160\151\137status" => $O4["\147oogle_maps_ap\151\137\163tatus"],"\155eters" => __("meters","lmm"),"feet" => __("feet","lmm"))); } else { $google_adsense_format=$O4["goog\154\145\137adsense_forma\164"]; $google_adsense_position=$O4["goog\154\145\137adsense_posit\151\157\156"]; $google_adsense_backgroundColor=htmlspecialchars($O4["google_adsense_ba\143\153\147roundColor"]); $google_adsense_borderColor=htmlspecialchars($O4["\147\157ogle_adsense_borde\162\103\157lor"]); $google_adsense_titleColor=htmlspecialchars($O4["\147\157ogle_adsense_bor\144\145\162Color"]); $google_adsense_textColor=htmlspecialchars($O4["\147\157ogle_adsense_te\170\164\103olor"]); $google_adsense_urlColor=htmlspecialchars($O4["\147\157\157gle_adsense\137\165\162lColor"]); $google_adsense_channelNumber=htmlspecialchars($O4["google_adsense_ch\141\156\156elNumber"]); $google_adsense_publisherId=htmlspecialchars($O4["google_adsen\163\145\137publisherId"]); wp_localize_script("leafletmap\163\155\141rker-core","\155apsmarkerjspr\157",array("\172oom_in" => __("Zoom i\156","\154\155\155"),"zoom_out" => __("\132\157om out","lmm"),"googlemaps_l\141\156\147uage" => $google_language,"\147ooglemaps_librari\145\163" => $gmaps_libraries,"googlemaps_base_d\157\155\141in" => $gmaps_base_domain,"bi\156\147\137culture" => $bing_culture,"google_\141\144\163ense_status" => $google_adsense_status,"\147\157\157gle_adsense_forma\164" => $google_adsense_format,"\147oogle_adsen\163\145\137position" => $google_adsense_position,"google_adsense_bac\153\147\162oundColor" => $google_adsense_backgroundColor,"google_adsense_bo\162\144\145rColor" => $google_adsense_borderColor,"\147oogle_adsense_ti\164\154\145Color" => $google_adsense_titleColor,"google_a\144\163\145nse_textColor" => $google_adsense_textColor,"google_adsense_url\103\157\154or" => $google_adsense_urlColor,"\147\157ogle_adsense\137\143\150annelNumber" => $google_adsense_channelNumber,"google_ads\145\156\163e_publisherId" => $google_adsense_publisherId,"google_styling_j\163\157\156" => $google_styling_json,"minimap_show" => __("\123\150\157w minimap","\154\155m"),"minima\160\137\150ide" => __("\110ide minimap","lmm"),"minimap_status" => $O4["minimap\137\163\164atus"],"fullscreen_but\164\157\156_title" => __("View fullscreen","lm\155"),"\146ullscreen_button\137\164\151tle_exit" => __("Exit f\165\154\154screen","\154\155m"),"\146\165\154lscreen_button_po\163\151\164ion" => $O4["map_full\163\143\162een_button_po\163\151\164ion"],"maxzoom" => intval($O4["\147\154obal_maxzoom_lev\145\154"]),"google_maps_api_st\141\164\165s" => $O4["google_m\141\160\163_api_status"],"meters" => __("\155eters","lmm"),"feet" => __("feet","lmm"))); } } function lmm_admin_enqueue_scripts() { global $wp_version,$locale; $O4=get_option("\154\145afletmapsmar\153\145\162_options"); $l5=get_option("leafletmapsmarke\162\137\166ersion_pro"); $google_adsense_status=$O4["google\137\141\144sense_status"]; if ($google_adsense_status == "\145\156abled") { $gmaps_libraries="\046libraries=places,a\144\163\145nse"; } else { $gmaps_libraries="&libraries=pla\143\145\163"; } if ($locale != NULL) { $lang=substr($locale,0,2); } else { $lang="en"; } if ($O4["\147\157ogle_maps_language\137\154\157calization"] == "\142rowser_setting") { $google_language=""; } else if ($O4["google_maps_l\141\156\147uage_local\151\172\141tion"] == "\167\157rdpress_settin\147") { if ($locale != NULL) { $google_language="&language=".substr($locale,0,2); } else { $google_language="\046langua\147\145\075en"; } } else { $google_language="\046\154anguage=".$O4["\147\157\157gle_maps_lan\147\165\141ge_localiza\164\151\157n"]; } if ($O4["google_map\163\137\142ase_domain_c\165\163\164om"] != "") { $gmaps_base_domain="&base_do\155\141in=".$O4["google_maps_ba\163\145\137domain"]; } else { $gmaps_base_domain="&base_domain=".htmlspecialchars($O4["google_maps_base\137\144\157main_custo\155"]); } wp_enqueue_script(array("jquery")); $page=( isset ($_GET["\160\141ge"]) ? $_GET["\160\141ge"]: ""); if ($page == "leafletmapsmarke\162\137\154ayer") { if (version_compare($wp_version,"3.5",">=")) { wp_enqueue_media(); } else { wp_enqueue_style("thickbox"); wp_enqueue_script("media\055\165pload"); wp_enqueue_script("\164\150\151ckbox"); wp_enqueue_script("media-models"); } } if ( isset ($O4["\147oogle_maps_a\160\151\137key"]) && ($O4["\147\157ogle_maps_api\137\153\145y"] != NULL)) { $google_maps_api_key=$O4["g\157\157\147le_maps_api_ke\171"]; } else { $google_maps_api_key=""; } $ln=(is_ssl() == TRUE) ? "\150ttps": "http"; if ($O4["\147oogle_places_\163\164\141tus"] == "\145nabled") { wp_enqueue_script("\154eafletmapsmar\153\145\162-googlemaps-\154\157\141der",$ln."\072\057/www.google.com/\152\163\141pi?key=".$google_maps_api_key,array(),.37e1,TRUE); } $google_styling_json=($O4["g\157\157gle_styling_json"] == NULL) ? "\144\151\163abled": str_replace("\042","'",$O4["\147\157ogle_styling_js\157\156"]); if ($O4["\142\151\156gmaps_culture"] == "automatic") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="en_us"; } } else { $bing_culture=$O4["bingmaps_cultur\145"]; } if ($O4["\147\157ogle_places_stat\165\163"] == "\145\156abled") { wp_enqueue_script("\154\145afletmapsmarker\055\143\157re",O1."leaflet\055\144\151st/leaflet-c\157\162\145.js",array("\154\145afletmapsmarker\055\147\157oglemaps-lo\141\144\145r"),$l5,FALSE); wp_enqueue_script("leafletmapsm\141\162\153er-addons",O1."\154eaflet-dist/lea\146\154\145t-addons.js",array("leafletmapsmarker-c\157\162\145"),$l5,FALSE); $On="\145nabled"; } else { wp_enqueue_script("\154\145afletmapsmar\153\145\162-core",O1."\154\145\141flet-dist/lea\146\154\145t-core.js",array(),$l5,FALSE); wp_enqueue_script("leafletmapsma\162\153\145r-addons",O1."lea\146\154\145t-dist/leaflet\055\141\144dons.js",array("\154eafletmapsma\162\153\145r-core"),$l5,FALSE); $On="\144\151sabled"; } if ($google_adsense_status == "\144\151sabled") { wp_localize_script("leafletmapsmarke\162\055\143ore","\155\141psmarkerjspro",array("zoom_in" => __("Zoom in","lmm"),"zoo\155\137\157ut" => __("\132\157om out","lmm"),"googlemaps_langu\141\147\145" => $google_language,"\147ooglemaps_librari\145\163" => $gmaps_libraries,"googlemaps\137\142\141se_domain" => $gmaps_base_domain,"\142ing_culture" => $bing_culture,"google\137\141\144sense_status" => $google_adsense_status,"\147oogle_styling_json" => $google_styling_json,"\155\151nimap_show" => __("Show min\151\155\141p","lm\155"),"\155\151nimap_hide" => __("Hi\144\145\040minimap","\154\155\155"),"\155inimap_status" => $O4["\155\151nimap_status"],"fullscre\145\156\137button_title" => __("View fu\154\154\163creen","lmm"),"fullscre\145\156\137button_title_e\170\151\164" => __("\105\170it fullscreen","l\155\155"),"fullscreen_but\164\157\156_position" => $O4["\155ap_fullscreen_bu\164\164\157n_position"],"\155axzoom" => intval($O4["\147\154\157bal_maxzoom_l\145\166\145l"]),"goo\147\154\145_maps_api_status" => $On,"\155\145ters" => __("\155\145\164ers","lmm"),"feet" => __("feet","lmm"))); } else { $google_adsense_format=$O4["go\157\147\154e_adsense_form\141\164"]; $google_adsense_position=$O4["\147\157\157gle_adsense_po\163\151\164ion"]; $google_adsense_backgroundColor=htmlspecialchars($O4["google_adsense_bac\153\147\162oundColor"]); $google_adsense_borderColor=htmlspecialchars($O4["go\157\147\154e_adsense_borde\162\103\157lor"]); $google_adsense_titleColor=htmlspecialchars($O4["\147oogle_adsense_b\157\162\144erColor"]); $google_adsense_textColor=htmlspecialchars($O4["\147oogle_adsense_text\103\157\154or"]); $google_adsense_urlColor=htmlspecialchars($O4["\147\157\157gle_adsense\137\165\162lColor"]); $google_adsense_channelNumber=htmlspecialchars($O4["google_adse\156\163\145_channelNumber"]); $google_adsense_publisherId=htmlspecialchars($O4["\147oogle_adsen\163\145\137publisherId"]); wp_localize_script("leafletmaps\155\141\162ker-core","\155apsmarkerjspro",array("zoom_in" => __("\132\157om in","lmm"),"zoom_out" => __("Zoom out","lmm"),"googlem\141\160\163_language" => $google_language,"\147\157oglemaps_librar\151\145\163" => $gmaps_libraries,"\147\157\157glemaps_base_dom\141\151\156" => $gmaps_base_domain,"\142\151ng_culture" => $bing_culture,"\147\157\157gle_adsense_st\141\164\165s" => $google_adsense_status,"\147oogle_adsense_\146\157\162mat" => $google_adsense_format,"\147oogle_adsense_\160\157\163ition" => $google_adsense_position,"\147oogle_adsense_b\141\143\153groundColor" => $google_adsense_backgroundColor,"google_a\144\163\145nse_borderCol\157\162" => $google_adsense_borderColor,"google\137\141\144sense_titleColo\162" => $google_adsense_titleColor,"google_ads\145\156\163e_textColor" => $google_adsense_textColor,"\147oogle_adsense\137\165\162lColor" => $google_adsense_urlColor,"\147oogle_adsense_ch\141\156\156elNumber" => $google_adsense_channelNumber,"google_adsense_\160\165\142lisherId" => $google_adsense_publisherId,"\147\157\157gle_styling_j\163\157\156" => $google_styling_json,"\155inimap_show" => __("Show minimap","lm\155"),"\155\151nimap_hide" => __("\110\151de minimap","lmm"),"minimap_status" => $O4["minimap_status"],"\146ullscreen_bu\164\164\157n_title" => __("\126\151ew fullscreen","\154\155m"),"fullscre\145\156\137button_title_ex\151\164" => __("E\170\151\164 fullscreen","lmm"),"fullscreen_button_p\157\163\151tion" => $O4["map_\146\165\154lscreen_button\137\160\157sition"],"\155\141\170zoom" => intval($O4["\147\154\157bal_maxzoom_l\145\166\145l"]),"\147\157ogle_maps_api_sta\164\165\163" => $On,"\155\145ters" => __("met\145\162\163","lmm"),"\146\145et" => __("\146\145et","\154mm"))); } } function lmm_admin_enqueue_scripts_jquerydatepicker() { $l5=get_option("leafletmapsmarker\137\166\145rsion_pro"); wp_enqueue_script("\152\161uery-ui-timepicke\162\055addon",O1."\151nc/js/jquery-u\151\055\164imepicker-a\144\144\157n.js",array("\152query","\152query-ui-tabs","\152\161uery-ui-date\160\151\143ker","\152\161uery-ui-slide\162"),$l5); } function lmm_frontend_enqueue_stylesheets() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); global $wp_query; $posts=$wp_query->posts; $pattern=get_shortcode_regex(); $l5=get_option("leafl\145\164\155apsmarker_vers\151\157\156_pro"); if (function_exists("\151\163_rtl") && is_rtl()) { $lo="\154\145\141fletmapsmarker\055\162tl"; $Oo="leaf\154\145\164-rtl.min.css"; } else { $lo="\154eafletmapsmarker"; $Oo="\154eaflet.min.css"; } wp_register_style($lo,O1."\154eaflet-dist/".$Oo,array(),$l5); if (is_array($posts)) { foreach ($posts as $post) { if (preg_match_all("/".$pattern."/s",$post->post_content ,$matches) && array_key_exists(2,$matches) && in_array($O4["shortcod\145"],$matches[2])) { wp_enqueue_style($lo); break; } } $lmm_custom_css=".leaflet-popup\055\143\157ntent img\040\173\040".htmlspecialchars($O4["\144\145\146aults_marker\137\160\157pups_image_\143\163\163"])."\040\175 .marker-cl\165\163\164er-small \173\040\142\141ckground\055\143\157lor: ".htmlspecialchars($O4["clustering_color_\163\155\141ll"])."; } .marker-clu\163\164\145r-small div \173\040\142ackground-c\157\154\157r: ".htmlspecialchars($O4["\143lustering_col\157\162\137small_inner"])."\073\040color: ".htmlspecialchars($O4["\143lustering_color_smal\154\137\164ext"])."; } \056\155\141rker-cluster-m\145\144\151um \173 ba\143\153\147round-color\072\040".htmlspecialchars($O4["clustering_color_\155\145\144ium"])."; } .marker-c\154\165\163ter-medium di\166\040\173 backgrou\156\144\055color: ".htmlspecialchars($O4["\143lustering_color_m\145\144\151um_inner"]).";  color: ".htmlspecialchars($O4["\143\154ustering_colo\162\137\155edium_text"])."\073\040} .marker-cluster\055\154\141rge \173 b\141\143\153ground-colo\162\072\040".htmlspecialchars($O4["c\154\165\163tering_color_la\162\147\145"])."; } .marker-\143\154\165ster-large d\151\166\040\173 ba\143\153\147round-col\157\162\072 ".htmlspecialchars($O4["\143\154ustering_color_\154\141\162ge_inner"]).";  co\154\157\162: ".htmlspecialchars($O4["\143\154ustering_color_l\141\162\147e_text"])."; }"; wp_add_inline_style($lo,$lmm_custom_css); } } function lmm_template_check_shortcode($template) { $O4=get_option("\154\145\141fletmapsmark\145\162\137options"); $searchterm="\133".$O4["\163hortcode"]; $files=array($template,get_stylesheet_directory().DIRECTORY_SEPARATOR."\150eader.php",get_stylesheet_directory().DIRECTORY_SEPARATOR."footer.php"); if (function_exists("is_rtl") && is_rtl()) { $lo="\154eafletmapsm\141\162\153er-rtl"; $Oo="\154\145\141flet-rtl.min.c\163\163"; } else { $lo="l\145\141\146letmapsmarker"; $Oo="leaflet\056\155\151n.css"; } foreach ($files as $file) { if (file_exists($file)) { $contents=file_get_contents($file); if (strpos($contents,$searchterm)) { $l5=get_option("\154\145\141fletmapsmark\145\162\137version_pro"); wp_register_style($lo,O1."leaflet-dist/".$Oo,array(),$l5); wp_enqueue_style($lo); break; } } } return $template; } function lmm_admin_enqueue_stylesheets() { $l5=get_option("leafletmapsmarke\162\137\166ersion_pro"); if (function_exists("is_rtl") && is_rtl()) { wp_register_style("leafletmapsmark\145\162\055admin-rtl",O1."\151\156c/css/leafle\164\155\141psmarker-admi\156\055\162tl.css",array(),$l5); wp_enqueue_style("leafletmap\163\155\141rker-admin-r\164\154"); } else { wp_register_style("leafletmapsm\141\162\153er-admin",O1."\151\156c/css/leafletmaps\155\141\162ker-admin.c\163\163",array(),$l5); wp_enqueue_style("leafletmapsma\162\153\145r-admin"); } } function lmm_admin_enqueue_stylesheets_leaflet() { global $wp_version; $l5=get_option("\154\145afletmapsmarke\162\137\166ersion_pro"); if (function_exists("\151s_rtl") && is_rtl()) { $lo="\154eafletmapsmarke\162\055\162tl"; $Oo="\154eaflet-rtl.min.\143\163\163"; } else { $lo="\154eafletmapsmarker"; $Oo="l\145\141\146let.min.css"; } wp_register_style($lo,O1."leafl\145\164\055dist/".$Oo,array(),$l5); wp_enqueue_style($lo); if (version_compare($wp_version,"\063.7",">=")) { $O4=get_option("l\145\141\146letmapsmarker_o\160\164\151ons"); $lmm_custom_css="\056\154\145aflet-popup-\143\157\156tent img \173\040".htmlspecialchars($O4["defaul\164\163\137marker_popups\137\151\155age_css"])."\040} .marker-clust\145\162\055small \173 \142\141\143kground-co\154\157\162: ".htmlspecialchars($O4["clustering_color\137\163\155all"])."; } .ma\162\153\145r-cluster-smal\154\040\144iv \173 b\141\143\153ground-col\157\162\072 ".htmlspecialchars($O4["\143lustering_color\137\163\155all_inner"])."; colo\162\072\040".htmlspecialchars($O4["clustering\137\143\157lor_small_te\170\164"])."\073 } .marker-c\154\165\163ter-medium \173\040\142ackground-c\157\154\157r: ".htmlspecialchars($O4["\143lustering_color_\155\145\144ium"])."; } .marker\055\143\154uster-medium\040\144\151v \173 bac\153\147\162ound-colo\162\072\040".htmlspecialchars($O4["clustering_colo\162\137medium_inner"])."; col\157\162\072 ".htmlspecialchars($O4["\143\154\165stering_color_m\145\144\151um_text"])."\073\040} .marker-clus\164\145\162-large \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["cluste\162\151\156g_color_large"])."; } .marker-c\154\165\163ter-large div \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["clustering_co\154\157\162_large_inner"]).";\040\143\157lor: ".htmlspecialchars($O4["cluster\151\156g_color_large_t\145\170\164"])."\073 }"; wp_add_inline_style($lo,$lmm_custom_css); } } function lmm_admin_enqueue_stylesheets_datepicker() { $l5=get_option("\154\145afletmapsma\162\153\145r_version_pr\157"); wp_register_style("\154\145\141fletmapsm\141\162\153er-jquery-ui-\143\165\163tom",O1."\151\156\143/css/jquery-dat\145\160\151cker-theme/jq\165\145\162y-ui-custo\155\056\143ss",array(),$l5); wp_enqueue_style("\154\145\141fletmapsmark\145\162\055jquery-ui-\143\165\163tom"); } function lmm_admin_enqueue_stylesheets_adminbar() { $O4=get_option("\154\145afletmapsmarker_\157\160\164ions"); if ($O4["admin_bar_integr\141\164\151on"] == "enabled" && current_user_can($O4["\143apabilities_edi\164"])) { $l5=get_option("leafletmaps\155\141\162ker_version_\160\162\157"); wp_register_style("lea\146\154\145tmapsmarker-ad\155\151\156-adminbar",O1."inc/css/leafletmap\163\155\141rker-admin\055\141\144minbar.css",array(),$l5); wp_enqueue_style("leafletmapsmarke\162\055\141dmin-admin\142\141\162"); } } function lmm_install_and_updates() { $current_version="vp23\061"; $schedule_transient="\154eafletmapsmarker\137\151\156stall_update_c\141\143\150e_".$current_version; $install_update_schedule=get_transient($schedule_transient); if ($install_update_schedule === FALSE) { $schedule_transient="leafletmapsma\162\153\145r_install_u\160\144\141te_cache_".$current_version; set_transient($schedule_transient,"execute install an\144\040\165pdate-rout\151\156\145 only once\040\141\040day",074*074*030); include ("\151\156\143".DIRECTORY_SEPARATOR."\151\156\163tall-and-upd\141\164\145s.php"); } } function lmm_plugin_meta_links() { define( "FB_BASENAME" ,plugin_basename( __FILE__)); define( "FB_BASEFOLDER" ,plugin_basename(dirname( __FILE__))); define( "FB_FILENAME" ,str_replace(FB_BASEFOLDER."\057","",plugin_basename( __FILE__))); function leafletmapsmarker_filter_plugin_meta($links,$file) { if ($file == FB_BASENAME) { array_unshift($links,"<a href=\042".l1."\141dmin.php?page=\154\145\141fletmapsmarke\162\137\155arkers\042\076".__("\115arkers","lmm")."\074/a>","\074\141\040href=\042".l1."\141\144\155in.php?page=\154\145\141fletmapsmark\145\162\137layers\042\076".__("\114\141\171ers","lmm")."</a>","<a href\075\042".l1."\141dmin.php?pag\145\075\154eafletmapsma\162\153\145r_settings\042\076".__("\123ettings","lmm")."\074/a>","<a href=\042".l1."\141\144\155in.php?page=\154\145\141fletmapsmarke\162\137\154icense\042\076".__("\114\151cense","lmm")."\074\057a>"); } return $links; } add_filter("plugin_\141\143\164ion_links","\154\145afletmapsmark\145\162\137filter_plugin\137\155\145ta",012,2); } } if (is_admin()) { $lk= isset ($_GET["page"]) ? $_GET["\160\141ge"]: ""; $lp=array("\154eafletmapsmarker\137\155\141rkers","leafl\145\164\155apsmarker_mar\153\145\162","leafletmapsmarker_\151\155\160ort_export","leafletmaps\155\141\162ker_layers","\154eafletmapsma\162\153\145r_layer","\154\145afletmapsmarke\162\137\164ools","leafletmapsmarker_\163\145\164tings"); if ((in_array($lk,$lp)) && (O3() === FALSE)) { if (Op() !== TRUE) { exit (header("\114\157\143ation: ".l1."\141\144\155in.php?page\075\154\145afletmapsma\162\153\145r_license")); } if (la($Oa=l0,$lb=FALSE) === FALSE) { $lq=array("\154eafletmapsmarker_\155\141\162kers","\154\145afletmapsmarker_\155\141\162ker","\154eafletmapsmarker_im\160\157\162t_export","\154eafletmapsmarker\137\154\141yers","\154\145\141fletmapsmarke\162\137\154ayer","\154eafletmapsmark\145\162\137tools","\154\145afletmapsmarker\137\163\145ttings"); if (in_array($lk,$lq)) { echo "\074script type=\042\164\145\170t/javascri\160\164\042>window.\154\157\143ation.hr\145\146\040= \042".l1."\141\144min.php?page=lea\146\154\145tmapsmarker_l\151\143\145nse&error=\154\145\042;</script>\040\040"; } } } } function Oq($lr,$is_theme=FALSE) { $ls=""; if ( isset ($_GET["\160age"])) { $ls=$_GET["\160age"]; } elseif ( isset ($_POST["\160age"])) { $ls=$_POST["\160age"]; } $Os=in_array($ls,$lr); if ($is_theme) { return $Os; } $lt=in_array(plugin_basename( __FILE__),get_option("\141ctive_plugins")); return ($Os && $lt); } function Op($Ot=FALSE) { $lu=new Ou; $lu->lv ="\144\141\164abase"; $lu->Ov =array("\154ocal_key" => get_option("leafletmap\163\155\141rkerpro_lic\145\156\163e_local_key")); $lu->lw =array("\146\165nction" => "update_option","key" => "\154eafletmapsmarkerp\162\157\137license_lo\143\141\154_key"); $lu->Ow ="1,2,3,4,5,6,7,8,\071\05410"; $lu->lx =get_option("\154eafletmapsmar\153\145\162pro_license_\153\145\171"); $lu->Ox ="\067\143a99e156b5e30e06\064\070f49b81178cd7e"; $lu->ly ="\150ttps://www.m\141\160\163marker.com/\163\164\157re/api/ind\145\170\056php"; $lu->validate(); if ($Ot) { return $lu; } $lr=array("\154eafletmapsmarke\162\137\155arkers","leafletmapsmar\153\145\162_marker","leafle\164\155\141psmarker_import\137\145\170port","leafletmapsmarker\137\154\141yers","\154\145\141fletmapsmarker\137\154\141yer","\154\145afletmapsmarker\137\164\157ols","leafl\145\164\155apsmarker_sett\151\156\147s"); if (is_admin() && Oq($lr,TRUE) && $lu->Oy) { return $lu->Oy; } return TRUE; } function la($Oa=FALSE,$lb=FALSE) { $lu=new Ou; if ($Oa !== FALSE) { $lu->Oa =strrev(substr($Oa,1,012)); } $lu->lv ="database"; $lu->Ov =array("\154ocal_key" => get_option("\154\145afletmapsmar\153\145\162pro_license_\154\157cal_key")); $lu->lw =array("\146unction" => "\165pdate_option","\153ey" => "leafletmapsmarker\160\162\157_license_loca\154\137\153ey"); $lu->Ow ="\061\0542,3,4,5,6,7,8,\071\05410"; $lu->lx =get_option("\154\145afletmapsmarkerpr\157\137\154icense_key"); $lu->Ox ="7ca99e156b\065\145\0630e0648f49b\070\061\06178cd7e"; $lu->ly ="\150ttps://www.mapsma\162\153\145r.com/store/a\160\151\057index.php"; $lu->validate(); if ($lb !== FALSE) { if ($lu->Oy) { return FALSE; } else { return TRUE; } } if ($lu->Oy) { return FALSE; } if ($Oa === FALSE) { $lz=$lu->Oz["d\157\167\156load_access\137\145\170pires"]; $l10=$lu->Oz["support\137\141\143cess_expires"]; $O10=abs(($lz>$l10) ? $lz: $l10); if (!l11()) { if ($lu->Oz["\154\151cense_expires"] == "never") { return FALSE; } if (time()>$lu->Oz["licen\163\145\137expires"]) { return FALSE; } return TRUE; } return ($O10>time()) ? TRUE: FALSE; } else if ($Oa !== FALSE) { $lz=$lu->Oz["\144\157wnload_access_e\170\160\151res"]; $l10=$lu->Oz["\163\165pport_access_ex\160\151\162es"]; $O10=abs(($lz>$l10) ? $lz: $l10); if (!l11()) { if ($lu->Oz["lic\145\156\163e_expires"] == "never") { return FALSE; } if (time()>$lu->Oz["license_expi\162\145\163"]) { return FALSE; } return TRUE; } if ($lu->Oa >$O10) { return FALSE; } else { return TRUE; } } } function lmm_validate_license_info($release_date_info=FALSE,$license_only_info=FALSE) { $spbas_info=new Ou; if ($release_date_info !== FALSE) { $spbas_info->release_date_info =strrev(substr($release_date_info,1,012)); } $spbas_info->lv ="databa\163\145"; $spbas_info->Ov =array("local_key" => get_option("\154\145afletmapsmark\145\162\160ro_license_lo\143\141\154_key")); $spbas_info->lw =array("functi\157\156" => "update_opti\157\156","key" => "leafletmapsm\141\162\153erpro_licens\145\137\154ocal_key"); $spbas_info->Ow ="\061\0542,3,4,5,6,7,8,\071\054\0610"; $spbas_info->lx =get_option("\154eafletmapsmar\153\145\162pro_license_k\145\171"); $spbas_info->Ox ="\067\143\14199e156b5e30e\060\066\0648f49b81178c\144\067\145"; $spbas_info->ly ="https://www.mapsm\141\162\153er.com/sto\162\145\057api/index.\160\150\160"; $spbas_info->validate(); if ($license_only_info !== FALSE) { if ($spbas_info->Oy) { return FALSE; } else { return TRUE; } } if ($spbas_info->Oy) { return FALSE; } if ($release_date_info === FALSE) { $download_expires_info=$spbas_info->Oz["\144ownload_acce\163\163\137expires"]; $support_expires_info=$spbas_info->Oz["su\160\160\157rt_access_exp\151\162\145s"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!l11()) { if ($spbas_info->Oz["license_e\170\160\151res"] == "never") { return FALSE; } if (time()>$spbas_info->Oz["\154icense_expires"]) { return FALSE; } return TRUE; } return ($expires_info>time()) ? TRUE: FALSE; } else if ($release_date_info !== FALSE) { $download_expires_info=$spbas_info->Oz["download_access_\145\170\160ires"]; $support_expires_info=$spbas_info->Oz["\163upport_acces\163\137\145xpires"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!l11()) { if ($spbas_info->Oz["license_expi\162\145\163"] == "\156ever") { return FALSE; } if (time()>$spbas_info->Oz["\154icense_expir\145\163"]) { return FALSE; } return TRUE; } if ($spbas_info->Oa >$expires_info) { return FALSE; } else { return TRUE; } } } function l11($prefix="\115\141\160sMarkerPro-") { return substr(get_option("leafletmapsmarke\162\160\162o_license_ke\171"),0,strlen($prefix)) == $prefix; } function lmm_pro_version_info($prefix="MapsMarke\162\120\162o-") { return substr(get_option("leafletmapsm\141\162\153erpro_licen\163\145\137key"),0,strlen($prefix)) == $prefix; } function O11($prefix="\115apsMarkerPro\055\065P-") { return substr(get_option("\154eafletmapsmar\153\145\162pro_license_\153\145\171"),0,strlen($prefix)) == $prefix; } function l12($prefix="Map\163\115\141rkerPro-25P-") { return substr(get_option("leafletmapsm\141\162\153erpro_licen\163\145\137key"),0,strlen($prefix)) == $prefix; } function O12($prefix="\115\141psMarkerPro-1\060\060\120-") { return substr(get_option("leafletmapsmark\145\162\160ro_license_\153\145\171"),0,strlen($prefix)) == $prefix; } function l13($prefix="MapsMarkerPro-25\060\120-") { return substr(get_option("leaf\154\145\164mapsmarkerpro\137\154\151cense_key"),0,strlen($prefix)) == $prefix; } function O13($prefix="\115apsMarkerPro-\065\060\060P-") { return substr(get_option("leafletmapsmarke\162\160\162o_license_ke\171"),0,strlen($prefix)) == $prefix; } function l14($prefix="MapsMar\153\145\162Pro-1000P-") { return substr(get_option("lea\146\154\145tmapsmarkerpr\157\137\154icense_key"),0,strlen($prefix)) == $prefix; } function O14($attribute) { if ( isset ($_POST[$attribute]) && ($_POST[$attribute] == TRUE)) { return $_POST[$attribute]; } global $current_user; get_currentuserinfo(); switch ($attribute) { case "\155aps_marker_pr\157\137\146irst_name": return $current_user->user_firstname; case "\155\141ps_marker_pro\137\154\141st_name": return $current_user->user_lastname; case "\155\141ps_marker_pr\157\137\145mail": return $current_user->user_email; } return ""; } function maps_marker_pro_license_activation_page() { if ( isset ($_POST["maps_marker_pro\137\162\145gister_free"])) { $lu=new Ou; $l15=""; $O15=array(); if (!$_POST["\155aps_marker_pr\157\137\146irst_name"]) { $O15[]=__("Pleas\145\040enter your firs\164\040\156ame to cont\151\156\165e.","lm\155"); } if (!$_POST["\155\141ps_marker_p\162\157\137last_name"]) { $O15[]=__("Please ente\162\040\171our last na\155\145\040to cont\151\156\165e.","lmm"); } if (!$_POST["maps_mar\153\145\162_pro_email"]) { $O15[]=__("Please ente\162\040\171our email to\040\143\157ntinue.","\154mm"); } if (sanitize_email($_POST["\155aps_marker_pr\157\137\145mail"]) !== $_POST["m\141\160\163_marker_pro_e\155\141\151l"]) { $O15[]=__("\120lease enter\040\141\040valid email\040\164\157 continue (\157\162\040get an an\157\156\171mous tria\154\040\154icense k\145\171)","lmm"); } if (!$_POST["\155\141ps_marker_pro_t\157\163"]) { $O15[]=__("\131ou must agree\040\164\157 the TOS to \143\157\156tinue.","lmm"); } if (empty($O15)) { $qs="\155\157d=3rd_party\046\164\141sk=api&api_k\145\171\07550a209431\064\146\142c82e712b3\146\071\14221f0074\065\046\145mail=".urlencode(sanitize_email($_POST["\155aps_marker_pr\157\137\145mail"]))."\046\146irst_name=".urlencode($_POST["\155aps_marker_pro_fi\162\163\164_name"])."&last_name=".urlencode($_POST["maps_marker_pro_l\141\163\164_name"])."&co\155\160\141ny_name=".urlencode($_POST["\155aps_marker_pro\137\146\151rst_name"])."%20".urlencode($_POST["\155\141ps_marker_pro_\154\141\163t_name"])."&\165\163\145rname=".strtolower(sanitize_user($_POST["maps_marker_p\162\157\137last_name"],$l16=TRUE).substr(sanitize_user($_POST["maps_\155\141\162ker_pro_first\137\156\141me"],$l16=TRUE),0,1)); $O16=$lu->l17("htt\160\163\072//www.\155\141\160smarker.com/st\157\162\145/api/index.\160\150\160",$qs); if (strtolower(substr($O16,0,021)) == "\143onnection er\162\157\162:") { $O15[]=$O16; } else if (strtolower(substr($O16,0,5)) == "\145\162\162or") { $O15[]=$O16; } else { $O16=json_decode($O16); update_option("leafletmapsmarke\162\160\162o_license_ke\171",$lu->lx =$O16[0]); update_option("\154\145afletmapsmark\145\162\160ro_license_lo\143\141\154_key",""); update_option("leafletmapsma\162\153\145rpro_licens\145\137\153ey_trial",$lu->lx =$O16[0]); $l15=__("\131\157\165r new licens\145\040\167as register\145\144\040successfu\154\154\171!","lmm"); } } } else if ( isset ($_POST["\155aps_marker_pro\137\162\145gister_free_a\156\157\156ym"])) { $lu=new Ou; $l15=""; $O15=array(); if (!$_POST["maps_marker_pro_t\157\163"]) { $O15[]=__("You must agree to\040\164\150e TOS to co\156\164\151nue.","lmm"); } if (empty($O15)) { $qs="\155od=3rd_party\046\164\141sk=api&api_\153\145\171=f8b3782fef\062\065\1433f68e809\146\066\0621d193063"; $O16=$lu->l17("https://www.ma\160\163\155arker.com/s\164\157\162e/api/index.\160\150\160",$qs); if (strtolower(substr($O16,0,021)) == "connection \145\162\162or:") { $O15[]=$O16; } else if (strtolower(substr($O16,0,5)) == "\145rror") { $O15[]=$O16; } else { $O16=json_decode($O16); update_option("\154eafletmapsmarke\162\160\162o_license_key",$lu->lx =$O16[0]); update_option("leafletmapsmarker\160\162\157_license_lo\143\141\154_key",""); update_option("leafle\164\155\141psmarkerpro_l\151\143\145nse_key_tri\141\154",$lu->lx =$O16[0]); $l15=__("\131\157ur new licen\163\145\040was regist\145\162\145d successfu\154\154\171!","lmm"); } } } else { if (!function_exists("wp_verify\137\156\157nce")) { require_once (ABSPATH."wp-incl\165\144\145s/pluggable.p\150\160"); } $O17=( isset ($_POST["maps_marker_pr\157\137\154icense"]) && wp_verify_nonce($_POST["\155\141ps_marker_p\162\157\137license"],"maps_mark\145\162\137pro_license")); if ($O17) { update_option("lea\146\154\145tmapsmarkerpro\137\154\151cense_local_\153\145\171",""); update_option("leafletmapsmarke\162\160\162o_license_key",$_POST["leaflet\155\141\160smarkerpro_lic\145\156\163e_key"]); } $lu=Op(TRUE); } include dirname( __FILE__)."/leaflet-license\056\160\150p"; return TRUE; } class Ou { public $Oy; public $l18; public $lx; public $ly; public $O18; public $l19; public $lv; public $Ov; public $lw; public $O19; public $l1a; public $Ow; public $O1a; public $l1b; public $Oa; public $Oz; public $O1b; public $l1c; function Ou() { $this->Oy =FALSE; $this->l18 =""; $this->O18 =0120; $this->l19 =012; $this->O1c =array("\163pbas"); $this->l1d ="spbas"; $this->lv ="\146\151lesystem"; $this->Ow =0; $this->O1a =0; $this->Ov =FALSE; $this->lw =FALSE; $this->O19 =""; $this->l1a ="\154\151\143ense.txt"; $this->l1b =FALSE; $this->Oa =FALSE; $this->l1c =FALSE; $this->Oz =array("c\165\163\164om_fields" => array(),"\144ownload_acce\163\163\137expires" => 0,"\154icense_expires" => 0,"local_key_expires" => 0,"\163\164\141tus" => "Invalid",); $this->O1b =array("active" => __("This li\143\145\156se is active\056","\154\155\155"),"suspende\144" => sprintf(__("Error: T\150\151\163 license has\040\142\145en suspende\144\056\040This usu\141\154\154y happens\040\167\150en someo\156\145\040tries \164\157\040regist\145\162\040a secon\144\040\164rial li\143\145\156se for \164\150\145 same \144\157\155ain. <a\040\150ref=\042\045\061s\042\040\164arget=\042\137\142lank\042\076\120lease cl\151\143\153 here \164\157\040get a\040\156on-expiri\156\147\040lice\156\163\145 for \164\150\151s dom\141\151n.</a>","lmm"),"https://www.m\141\160\163marker.com/ord\145\162"),"\145\170pired" => sprintf(__("\131our free 30 day\040\164\162ial licens\145\040\153ey has exp\151\162\145d. <a hre\146\075\042%1s\042\040\164arget=\042\137\142\154ank\042\076\120lease pur\143\150\141se a va\154\151\144 pro lic\145\156\163e key \164\157\040contin\165\145\074/a>.","\154\155\155"),"\150\164tps://www.mapsm\141\162\153er.com/order"),"pending" => __("\105\162\162or: This lice\156\163\145 is pending \162\145\166iew.","lmm"),"d\157\167\156load_access_expir\145\144" => __("Error: This ver\163\151\157n of the soft\167\141\162e was rel\145\141\163ed after \171\157\165r downlo\141\144\040access\040\145\170pired\056\040Please ren\145\167\040your do\167\156\154oad and\040\163upport acc\145\163\163 or dow\156\147\162ade to \141\040previous v\145\162\163ion.","lmm"),"\155issing_\154\151\143ense_key" => __("\120\154ease enter a l\151\143\145nse key to c\157\156\164inue.","lm\155"),"\165\156\153nown_local_key_\164\171\160e" => __("\105\162ror: An unkno\167\156\040type of loca\154\040key valid\141\164ion was requ\145\163\164ed.","lmm"),"\143\157uld_not_obtain\137\154\157cal_key" => sprintf(__("Error: a new loca\154\040license key c\157\165\154d not be obt\141\151\156ed. Please \163\145\145 %s for m\157\162\145 informa\164\151\157n","\154\155\155"),"\074a href=\042\150\164\164ps://www.m\141\160\163marker.com\057\143\157nnect-erro\162\163\042 target=\042\137\142lank\042\076\155apsmarker.\143\157\155/connec\164\055\145rrors<\057\141>"),"\155\141\170imum_grace_p\145\162iod_expired" => __("Err\157\162\072 The maximum l\157\143\141l license key\040\147\162ace perio\144\040\150as expir\145\144\056","\154\155m"),"\154\157cal_key_tamper\151\156\147" => __("Error: The\040\154ocal license key \150\141\163 been tampere\144\040\167ith or i\163\040invalid.","\154\155m"),"loc\141\154\137key_invalid_for_\154\157\143ation" => __("Error: Th\145\040\154ocal license\040\153\145y is invali\144\040for this loca\164\151\157n.","lmm"),"\155\151ssing_license_file" => __("\105rror: Please c\162\145\141te the follow\151\156\147 file (and \144\151\162ectories \151\146\040they do \156\157\164 exist al\162\145ady):<br /\076\134r\134n<br \057\076\134r\134\156","lmm"),"licens\145\137\146ile_not_writabl\145" => __("\105rror: Please ma\153\145\040the followin\147\040\160ath writab\154\145\072<br />","lmm"),"\151\156valid_local_key\137\163\164orage" => __("Error: the local \153\145\171 storage on c\154\145\141r could not\040\144\145termined.","\154\155\155"),"co\165\154\144_not_save_local_\153\145\171" => __("\105rror: the loca\154\040\154icense key c\157\165\154d not save\144\056","\154\155m"),"li\143\145\156se_key_string_mi\163\155\141tch" => __("\105rror: The loc\141\154\040key is inv\141\154\151d for this \154\151\143ense.","lmm"),); $this->localization =array("\141\143\164ive" => __("\124\150\151s license is \141\143\164ive.","\154\155m"),"suspende\144" => sprintf(__("Error: This l\151\143\145nse has been \163\165\163pended. Thi\163\040\165sually ha\160\160\145ns when s\157\155\145one tries\040\164o register \141\040second tria\154\040license fo\162\040\164he same\040\144omain. <a \150\162\145f=\042\045\061s\042 ta\162\147\145t=\042\137\142\154ank\042\076\120lease cl\151\143\153 here \164\157\040get a\040\156on-expirin\147\040license \146\157\162 this \144\157main.</a>","lmm"),"\150\164tps://www.mapsmar\153\145\162.com/orde\162"),"\145\170pired" => sprintf(__("Yo\165\162\040free 30 day t\162\151\141l license key\040\150\141s expire\144\056\040<a href=\042\0451s\042 targ\145\164\075\042_\142\154ank\042>Pl\145\141\163e purch\141\163\145 a valid\040\160\162o licen\163\145\040key to\040\143ontinue</a\076\056","lmm"),"https://www.maps\155\141\162ker.com/order"),"pending" => __("\105rror: This li\143\145\156se is pending \162\145\166iew.","lmm"),"downlo\141\144\137access_expired" => __("Error: This ve\162\163\151on of the soft\167\141\162e was rele\141\163\145d after you\162\040\144ownload \141\143\143ess expi\162\145\144. Pleas\145\040renew your \144\157\167nload a\156\144\040support\040\141\143cess o\162\040\144owngra\144\145\040to a p\162\145\166ious ve\162\163\151on.","lmm")); } function validate() { if (!$this->lx) { return $this->Oy =$this->O1b["\155\151ssing_licen\163\145\137key"]; } if (!in_array(strtolower($this->l1d),$this->O1c)) { return $this->Oy =$this->O1b["\165nknown_local_k\145\171\137type"]; } $this->O1d =$this->O1b["could_not_obta\151\156\137local_key"]; switch ($this->lv) { case "\144\141\164abase": $l1e=$this->O1e(); break; case "filesyst\145\155": $l1e=$this->l1f(); break; default : return $this->Oy =$this->O1b["\155\151ssing_licens\145\137\153ey"]; } if ($this->Oy == $this->O1d && $this->Ow) { $O1f=$this->l1g($this->O1a); if ($O1f["\167rite"]) { if ($this->lv == "database") { $this->O1g($O1f["local\137\153\145y"]); } elseif ($this->lv == "filesyst\145\155") { $this->l1h($O1f["local_key"],"{$this->O19}{$this->l1a}"); } } if ($O1f["\145\162\162ors"]) { return $this->Oy =$O1f["\145\162\162ors"]; } $this->Oy =FALSE; return $this; } if ($this->Oy) { return $this->Oy; } return $this->O1h($l1e); } function l1i($O1i,$O1f) { return (( integer) $O1i+(( integer) $O1f*0250600)); } function l1g($l1e) { $l1j=$this->O1j($l1e); $l1k=$this->O1k($l1j); $Oz=unserialize($l1k[0]); $O1i=( integer) $Oz["local_key_exp\151\162es"]; unset ($l1k,$Oz); $l1l=FALSE; $l1k=explode("\012\012",$l1e); $l1e=$l1k[0]; foreach ($Ow=explode(",",$this->Ow) as $O1l => $O1f) { if (!$O1l) { $l1e.="\012"; } if ($this->l1i($O1i,$O1f)>time()) { continue; } $l1e.= "\012{$O1f}"; $l1l=TRUE; } if (time()>$this->l1i($O1i,array_pop($Ow))) { return array("\167rite" => FALSE,"\154\157cal_key" => "","\145\162rors" => $this->O1b["\155aximum_grace_\160\145\162iod_expired"]); } return array("\167rite" => $l1l,"local_key" => $l1e,"\145\162rors" => FALSE); } function l1m($l1e,$O1i) { $O1f=$this->O1k($l1e,"\012\012"); if (! isset ($O1f[1])) { return -1; } return ( integer)($this->l1i($O1i,array_pop(explode("\012",$O1f[1])))-time()); } function O1j($l1e) { return base64_decode(str_replace("\012","",urldecode($l1e))); } function O1k($l1e,$O1m="\173\163\160bas}") { return explode($O1m,$l1e); } function l1n($O1l,$O1n) { return in_array($O1l,(array) $O1n); } function wildcard_ip($O1l) { $octets=explode(".",$O1l); array_pop($octets); $ip_range[]=implode("\056",$octets).".*"; array_pop($octets); $ip_range[]=implode(".",$octets).".*"; array_pop($octets); $ip_range[]=implode("\056",$octets).".*"; return $ip_range; } function wildcard_domain($O1l) { return "\052.".str_replace("www.","",$O1l); } function wildcard_server_hostname($O1l) { $hostname=explode(".",$O1l); unset ($hostname[0]); $hostname=(! isset ($hostname[1])) ? array($O1l): $hostname; return "\052.".implode("\056",$hostname); } function extract_access_set($instances,$enforce) { foreach ($instances as $O1l => $instance) { if ($O1l != $enforce) { continue; } return $instance; } return array(); } function O1h($l1e) { $l1j=$this->O1j($l1e); $l1k=$this->O1k($l1j); if (! isset ($l1k[1])) { return $this->Oy =$this->O1b["\154ocal_key_t\141\155\160ering"]; } if (md5($this->Ox.$l1k[0]) != $l1k[1]) { return $this->Oy =$this->O1b["\154ocal_key_tam\160\145\162ing"]; } $Oz=unserialize($l1k[0]); $instance=$Oz["\151\156stance"]; unset ($Oz["\151\156stance"]); $enforce=$Oz["enforce"]; unset ($Oz["\145\156force"]); $this->Oz =$Oz; if (( string) $Oz["\154\151cense_key_str\151\156\147"] != ( string) $this->lx) { return $this->Oy =$this->O1b["license_\153\145\171_string_mis\155\141\164ch"]; } if (( string) $Oz["status"] != "\141\143tive") { return $this->Oy =$this->O1b[$Oz["\163tatus"]]; } if (( string) $Oz["license_expires"] != "never" && ( integer) $Oz["license\137\145\170pires"]<time()) { return $this->Oy =$this->O1b["\145xpired"]; } if (( string) $Oz["\154ocal_key_expires"] != "never" && ( integer) $Oz["local_k\145\171\137expires"]<time()) { if ($this->l1m($l1e,$Oz["loc\141\154\137key_expires"])<0) { $this->l1o(TRUE); return $this->validate(); } } if ($this->l1b && ( integer) $Oz["\144\157wnload_acces\163\137\145xpires"]<strtotime($this->Oa)) { return $this->Oy =$this->O1b["\144ownload_access_ex\160\151\162ed"]; } $conflicts=array(); $O1o=$this->l1p(); foreach ((array) $enforce as $O1l) { $O1n=$this->extract_access_set($instance,$O1l); if (!$this->l1n($O1o[$O1l],$O1n)) { $conflicts[$O1l]=TRUE; if (in_array($O1l,array("i\160","\163\145rver_ip"))) { foreach ($this->wildcard_ip($O1o[$O1l]) as $ip) { if ($this->l1n($ip,$O1n)) { unset ($conflicts[$O1l]); break; } } } elseif (in_array($O1l,array("domain"))) { if ($this->l1n($this->wildcard_domain($O1o[$O1l]),$O1n)) { unset ($conflicts[$O1l]); } } elseif (in_array($O1l,array("server\137\150\157stname"))) { if ($this->l1n($this->wildcard_server_hostname($O1o[$O1l]),$O1n)) { unset ($conflicts[$O1l]); } } } } if (!empty($conflicts)) { return $this->Oy =$this->O1b["\154ocal_key_inva\154\151\144_for_location"]; } } function O1e() { $Oe=array(); if (is_array($this->Ov)) { $Oe=$this->Ov; } else { $query=@mysql_query($this->Ov); if ($mysql_error=mysql_error()) { return $this->Oy = "\105\162ror: {$mysql_error}"; } $Oe=@mysql_fetch_assoc($query); if ($mysql_error=mysql_error()) { return $this->Oy = "\105rror: {$mysql_error}"; } } if (!$Oe["\154\157cal_key"]) { $Oe["\154\157cal_key"]=$this->O1p(); if ($this->Oy) { return $this->Oy; } $this->O1g($Oe["local_ke\171"]); } return $this->O1a =$Oe["\154\157cal_key"]; } function O1g($l1e) { if (is_array($this->lw)) { $l1q=$this->lw["function"]; return $l1q($this->lw["key"],$l1e); }@mysql_query(str_replace("\173\154\157\143al_key}",$l1e,$this->lw)); if ($mysql_error=mysql_error()) { return $this->Oy = "Error: {$mysql_error}"; } return TRUE; } function l1f() { if (!file_exists($path= "{$this->O19}{$this->l1a}")) { return $this->Oy =$this->O1b["\155\151\163sing_licens\145\137\146ile"].$path; } if (!is_writable($path)) { return $this->Oy =$this->O1b["license_file\137\156\157t_writable"].$path; } if (!$l1e=@file_get_contents($path)) { $l1e=$this->O1p(); if ($this->Oy) { return $this->Oy; } $this->l1h(urldecode($l1e),$path); } return $this->O1a =$l1e; } function l1o($clear=FALSE) { switch (strtolower($this->lv)) { case "\144atabase": $this->O1g(""); break; case "filesystem": $this->l1h("","{$this->O19}{$this->l1a}"); break; default : return $this->Oy =$this->O1b["\151nvalid_local_key\137\163\164orage"]; } } function l1h($l1e,$path) { $fp=@fopen($path,"\167"); if (!$fp) { return $this->Oy =$this->O1b["could_n\157\164\137save_local_ke\171"]; }@fwrite($fp,$l1e); @fclose($fp); return TRUE; } function O1p() { $querystring= "\155\157d=license&task=SP\102\101\123_validate_li\143\145\156se&license_\153\145\171={$this->lx}&"; $querystring.=$this->build_querystring($this->l1p()); if ($this->Oy) { return FALSE; } $Oe=$this->l17($this->ly ,$querystring); if (strtolower(substr($Oe,0,021)) == "\143\157nnection erro\162\072") { $this->l18 =$Oe; return FALSE; } if (!$Oe) { $this->Oy =$this->O1b["could_not_obtai\156\137local_key"]; return FALSE; } if (substr($Oe,0,7) == "\111nvalid") { $this->Oy =str_replace("\111\156valid","Err\157\162",$Oe); return FALSE; } if (substr($Oe,0,5) == "Error") { $this->Oy =$Oe; return FALSE; } return $Oe; } function build_querystring($array) { $buffer=""; foreach ((array) $array as $O1l => $value) { if ($buffer) { $buffer.="\046"; } $buffer.= "{$O1l}\075{$value}"; } return $buffer; } function l1p() { $O1o=array(); $O1o["domain"]=""; $O1o["ip"]="ip-\156\157\164-transmitte\144"; $O1o["d\151\162\145ctory"]="\144\151rectory-not-tran\163\155\151tted"; $O1o["\163erver_hostna\155\145"]="ser\166\145\162_hostname-not-t\162\141\156smitted"; $O1o["\163erver_ip"]="\163erver_ip-not-tr\141\156\163mitted"; $O1o["val\151\144\137for_product_t\151\145\162s"]=""; if (!extension_loaded("\163\165hosin")) { if (!defined( "SUHOSIN_PATCH")) { if (function_exists("phpi\156\146\157")) { ob_start(); phpinfo(INFO_GENERAL); phpinfo(INFO_ENVIRONMENT); $phpinfo=ob_get_contents(); ob_end_clean(); $list=strip_tags($phpinfo); $O1o["domain"]=$this->scrape_phpinfo($list,"HTTP_HOST"); } } } $O1o["domain"]=($O1o["\144omain"]) ? $O1o["\144\157\155ain"]: $_SERVER["\110\124\124P_HOST"]; foreach ($O1o as $O1l => $value) { if ($O1l == "\166alid_for_product_\164\151\145rs") { continue; } $O1o[$O1l]=($O1o[$O1l]) ? $O1o[$O1l]: "\125nknown"; } if ($this->l1c) { $O1o["valid\137\146\157r_product_tie\162\163"]=$this->l1c; } return $O1o; } function path_translated() { $option=array("\120ATH_TRANSLATED","\174|IG_PATH_TRANS\114\101\124ED","\123\103RIPT_FILENAME","DOCUMENT_ROOT","\101\120\120L_PHYSICAL_PAT\110"); foreach ($option as $O1l) { if (! isset ($_SERVER[$O1l]) || strlen(trim($_SERVER[$O1l]))<=0) { continue; } if ($this->is_windows() && strpos($_SERVER[$O1l],"\134")) { return @substr($_SERVER[$O1l],0,@strrpos($_SERVER[$O1l],"\134")); } return @substr($_SERVER[$O1l],0,@strrpos($_SERVER[$O1l],"/")); } return FALSE; } function server_addr() { $options=array("SERVER_\101\104\104R","\114\117\103AL_ADDR"); foreach ($options as $O1l) { if ( isset ($_SERVER[$O1l])) { return $_SERVER[$O1l]; } } return FALSE; } function scrape_phpinfo($all,$target) { $all=explode($target,$all); if (count($all)<2) { return FALSE; } $all=explode("\012",$all[1]); $all=trim($all[0]); if ($target == "Syst\145\155") { $all=explode(" ",$all); $all=trim($all[(strtolower($all[0]) == "windows" && strtolower($all[1]) == "nt") ? 2: 1]); } if ($target == "SCRIPT_FILEN\101\115\105") { $slash=($this->is_windows() ? "\134": "/"); $all=explode($slash,$all); array_pop($all); $all=implode($slash,$all); } if (substr($all,1,1) == "]") { return FALSE; } return $all; } function l17($url,$querystring) { $Oe=wp_remote_get($url."\077".$querystring,array("\163\163lverify" => TRUE,"timeout" => 024)); if (is_wp_error($Oe) || (( integer) $Oe["\162esponse"]["\143\157de"] != 0310)) { $Oe=wp_remote_get($url."?".$querystring,array("sslverify" => FALSE,"\164\151\155eout" => 012)); } if (is_wp_error($Oe) || (( integer) $Oe["\162esponse"]["\143ode"] != 0310)) { $url="\150ttps://www.ma\160\163\155arkerpro.com\057\160roxy.php?".$querystring; $Oe=wp_remote_get($url."\077".$querystring,array("\163\163lverify" => FALSE,"timeout" => 012)); } if (is_wp_error($Oe)) { $O1q="\103onnection er\162\157\162: ".$Oe->get_error_message()."<br/>".sprintf(__("\105rror: a new loca\154\040license key cou\154\144\040not be obta\151\156\145d. Please\040\163ee %s for m\157\162\145 informa\164\151\157n","lmm"),"<a href=\042\150\164tps://www.maps\155\141\162ker.com/conn\145\143\164-errors\042\040\164arget=\042\137\142lank\042\076\155\141psmark\145\162\056com/con\156\145\143t-error\163\074/a>"); return $O1q; } else { if (( integer) $Oe["\162esponse"]["\143\157de"] == 0310) { return $Oe["\142ody"]; } else { $O1q="Connection erro\162\072\040HTTP stat\165\163\040code ".$Oe["response"]["\143\157de"]."\040- ".$Oe["body"]; return $O1q; } } } function is_windows() { $l1r=explode("\054",ini_get("\144\151sable_functio\156\163")); foreach ($l1r as $O1r) { $l1s[]=trim($O1r); } if (!in_array("php_uname",$l1s)) { return (strtolower(substr(php_uname(),0,7)) == "\167indows"); } else { return (stristr( PHP_OS ,"\127\111\116")); } } function pr($stack,$O1s=TRUE) { $formatted="\074pre>".var_export((array) $stack,1)."\074\057pre>"; if ($O1s) { exit ($formatted); } return $formatted; } } $l1t=new l4(); if (is_admin()) { if (la()) { $O1t="www\056\155\141psmarker.com\057\165\160dates_pro/?\141\143\164ion=get_me\164\141\144ata&slug=l\145\141\146let-maps\055\155\141rker-pr\157"; $O4=get_option("\154eafletmapsmar\153\145\162_options"); if (( isset ($O4["\155isc_betatest"])) && ($O4["\155\151sc_betatest"] == "\145\156\141bled")) { $O1t=$O1t."-b\145\164\141"; } $l1u=new pluginupdatechecker_2_0($O1t,plugin_dir_path( __FILE__)."leaflet-m\141\160\163-marker.php","leaflet-\155\141\160s-marker-pro","12","\154eafletmapsma\162\153\145rpro_pluginup\144\141\164echecker"); } unset ($l1u); } register_activation_hook( __FILE__ ,array("Leafletmapsmarker\120\162\157","\154\155\155_register_activ\141\164\151on_hook")); require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143lass-leaflet-r\145\143\145nt-marker-wi\144\147\145t.php"); unset ($l1t); ?>